
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.0">
    
    
      
        <title>Local Explanation - text_explainability</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.fe914879.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ba0d045b.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="#80d8ff">
  
    
    <script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-text_explainabilitylocal_explanation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="text_explainability" class="md-header__button md-logo" aria-label="text_explainability" data-md-component="logo">
      
  <img src="https://i.ibb.co/pvkkWqZ/Text-Logo-Logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            text_explainability
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Local Explanation
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://git.science.uu.nl/m.j.robeer/text_explainability.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    text_explainability
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="text_explainability" class="md-nav__button md-logo" aria-label="text_explainability" data-md-component="logo">
      
  <img src="https://i.ibb.co/pvkkWqZ/Text-Logo-Logo-white.png" alt="logo">

    </a>
    text_explainability
  </label>
  
    <div class="md-nav__source">
      
<a href="https://git.science.uu.nl/m.j.robeer/text_explainability.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    text_explainability
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../docs/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../example_usage/" class="md-nav__link">
        Example usage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../CHANGELOG/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" checked>
      
      <label class="md-nav__link" for="__nav_5_1">
        Text Explainability
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Text Explainability" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Text Explainability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../decorators/" class="md-nav__link">
        Decorators
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../default/" class="md-nav__link">
        Default
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../global_explanation/" class="md-nav__link">
        Global Explanation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../internationalization/" class="md-nav__link">
        Internationalization
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Local Explanation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Local Explanation
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default_env" class="md-nav__link">
    default_env
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anchor" class="md-nav__link">
    Anchor
  </a>
  
    <nav class="md-nav" aria-label="Anchor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beam_search" class="md-nav__link">
    beam_search
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dlow_bernoulli" class="md-nav__link">
    dlow_bernoulli
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kl_bernoulli" class="md-nav__link">
    kl_bernoulli
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best_candidate" class="md-nav__link">
    best_candidate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate_candidates" class="md-nav__link">
    generate_candidates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factfoilmixin" class="md-nav__link">
    FactFoilMixin
  </a>
  
    <nav class="md-nav" aria-label="FactFoilMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#descendants" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_fact_foil" class="md-nav__link">
    to_fact_foil
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foiltree" class="md-nav__link">
    FoilTree
  </a>
  
    <nav class="md-nav" aria-label="FoilTree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_1" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_fact_foil_1" class="md-nav__link">
    to_fact_foil
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernelshap" class="md-nav__link">
    KernelSHAP
  </a>
  
    <nav class="md-nav" aria-label="KernelSHAP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods_1" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select_features" class="md-nav__link">
    select_features
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_3" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_2" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lime" class="md-nav__link">
    LIME
  </a>
  
    <nav class="md-nav" aria-label="LIME">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_3" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_4" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_3" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples_1" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localexplanation" class="md-nav__link">
    LocalExplanation
  </a>
  
    <nav class="md-nav" aria-label="LocalExplanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_4" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants_1" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_5" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_4" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localrules" class="md-nav__link">
    LocalRules
  </a>
  
    <nav class="md-nav" aria-label="LocalRules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_5" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_6" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_5" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_fact_foil_2" class="md-nav__link">
    to_fact_foil
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples_2" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localtree" class="md-nav__link">
    LocalTree
  </a>
  
    <nav class="md-nav" aria-label="LocalTree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_6" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_7" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_6" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples_3" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weightedexplanation" class="md-nav__link">
    WeightedExplanation
  </a>
  
    <nav class="md-nav" aria-label="WeightedExplanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#descendants_2" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_8" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples_4" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../locale/" class="md-nav__link">
        Locale
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_9" type="checkbox" id="__nav_5_1_9" >
      
      <label class="md-nav__link" for="__nav_5_1_9">
        Data
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Data" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_9">
          <span class="md-nav__icon md-icon"></span>
          Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../data/augmentation/" class="md-nav__link">
        Augmentation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../data/embedding/" class="md-nav__link">
        Embedding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../data/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../data/sampling/" class="md-nav__link">
        Sampling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../data/weights/" class="md-nav__link">
        Weights
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_10" type="checkbox" id="__nav_5_1_10" >
      
      <label class="md-nav__link" for="__nav_5_1_10">
        Generation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Generation" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_10">
          <span class="md-nav__icon md-icon"></span>
          Generation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../generation/feature_selection/" class="md-nav__link">
        Feature Selection
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../generation/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../generation/return_types/" class="md-nav__link">
        Return Types
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../generation/surrogate/" class="md-nav__link">
        Surrogate
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../generation/target_encoding/" class="md-nav__link">
        Target Encoding
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#default_env" class="md-nav__link">
    default_env
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#anchor" class="md-nav__link">
    Anchor
  </a>
  
    <nav class="md-nav" aria-label="Anchor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#beam_search" class="md-nav__link">
    beam_search
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dlow_bernoulli" class="md-nav__link">
    dlow_bernoulli
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kl_bernoulli" class="md-nav__link">
    kl_bernoulli
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best_candidate" class="md-nav__link">
    best_candidate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generate_candidates" class="md-nav__link">
    generate_candidates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#factfoilmixin" class="md-nav__link">
    FactFoilMixin
  </a>
  
    <nav class="md-nav" aria-label="FactFoilMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#descendants" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_fact_foil" class="md-nav__link">
    to_fact_foil
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#foiltree" class="md-nav__link">
    FoilTree
  </a>
  
    <nav class="md-nav" aria-label="FoilTree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_1" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_fact_foil_1" class="md-nav__link">
    to_fact_foil
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernelshap" class="md-nav__link">
    KernelSHAP
  </a>
  
    <nav class="md-nav" aria-label="KernelSHAP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#static-methods_1" class="md-nav__link">
    Static methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#select_features" class="md-nav__link">
    select_features
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_3" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_2" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lime" class="md-nav__link">
    LIME
  </a>
  
    <nav class="md-nav" aria-label="LIME">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_3" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_4" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_3" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples_1" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localexplanation" class="md-nav__link">
    LocalExplanation
  </a>
  
    <nav class="md-nav" aria-label="LocalExplanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_4" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants_1" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_5" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_4" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localrules" class="md-nav__link">
    LocalRules
  </a>
  
    <nav class="md-nav" aria-label="LocalRules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_5" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_6" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_5" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#to_fact_foil_2" class="md-nav__link">
    to_fact_foil
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples_2" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#localtree" class="md-nav__link">
    LocalTree
  </a>
  
    <nav class="md-nav" aria-label="LocalTree">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_6" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_7" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#augment_sample_6" class="md-nav__link">
    augment_sample
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples_3" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weightedexplanation" class="md-nav__link">
    WeightedExplanation
  </a>
  
    <nav class="md-nav" aria-label="WeightedExplanation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#descendants_2" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_8" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#weigh_samples_4" class="md-nav__link">
    weigh_samples
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="module-text_explainabilitylocal_explanation">Module text_explainability.local_explanation</h1>
<p>Local explanations explain why a model made a prediction for a single instance.</p>
<p>Todo:
    * Implement Anchors</p>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">   1</span>
<span class="normal">   2</span>
<span class="normal">   3</span>
<span class="normal">   4</span>
<span class="normal">   5</span>
<span class="normal">   6</span>
<span class="normal">   7</span>
<span class="normal">   8</span>
<span class="normal">   9</span>
<span class="normal">  10</span>
<span class="normal">  11</span>
<span class="normal">  12</span>
<span class="normal">  13</span>
<span class="normal">  14</span>
<span class="normal">  15</span>
<span class="normal">  16</span>
<span class="normal">  17</span>
<span class="normal">  18</span>
<span class="normal">  19</span>
<span class="normal">  20</span>
<span class="normal">  21</span>
<span class="normal">  22</span>
<span class="normal">  23</span>
<span class="normal">  24</span>
<span class="normal">  25</span>
<span class="normal">  26</span>
<span class="normal">  27</span>
<span class="normal">  28</span>
<span class="normal">  29</span>
<span class="normal">  30</span>
<span class="normal">  31</span>
<span class="normal">  32</span>
<span class="normal">  33</span>
<span class="normal">  34</span>
<span class="normal">  35</span>
<span class="normal">  36</span>
<span class="normal">  37</span>
<span class="normal">  38</span>
<span class="normal">  39</span>
<span class="normal">  40</span>
<span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>&quot;&quot;&quot;Local explanations explain why a model made a prediction for a single instance.

Todo:

    * Implement Anchors

&quot;&quot;&quot;

import numpy as np

import math

from typing import Callable, Optional, Sequence, Tuple, Union

from instancelib import (AbstractEnvironment, InstanceProvider,

                         LabelProvider, MemoryLabelProvider, TextEnvironment)

from instancelib.machinelearning import AbstractClassifier

from instancelib.instances.text import TextInstance, TextInstanceProvider

from sklearn.linear_model import Ridge

from sklearn.tree import DecisionTreeClassifier

from text_explainability.data.augmentation import (LocalTokenPertubator,

                                                   TokenReplacement)

from text_explainability.data.weights import (exponential_kernel,

                                              pairwise_distances)

from text_explainability.default import Readable

from text_explainability.generation.feature_selection import FeatureSelector

from text_explainability.generation.return_types import FeatureAttribution, Rules

from text_explainability.generation.surrogate import (LinearSurrogate,

                                                      TreeSurrogate,

                                                      RuleSurrogate)

from text_explainability.generation.target_encoding import FactFoilEncoder

from text_explainability.decorators import text_instance

from text_explainability.utils import binarize, default_detokenizer

import six

import sys

sys.modules[&#39;sklearn.externals.six&#39;] = six  # ensure backward compatibility

from skrules import SkopeRules  # noqa: E402

def default_env(env: Optional[AbstractEnvironment] = None) -&gt; AbstractEnvironment:

    &quot;&quot;&quot;If no environment is supplied, an empty Enviroment is created for text data.

    Args:

        env (Optional[AbstractEnvironment], optional): If a environment is supplied, it is used, otherwise.

    Returns:

        AbstractEnvironment: The default/supplied environment.

    &quot;&quot;&quot;

    if env is not None:

        return env

    empty_dataset = TextInstanceProvider([])

    empty_labels = MemoryLabelProvider([], {})

    empty_env = TextEnvironment(empty_dataset, empty_labels)

    return empty_env

class LocalExplanation(Readable):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 seed: int = 0):

        &quot;&quot;&quot;Generate explanation for a single decision.

        Args:

            env (Optional[AbstractEnvironment], optional): Environment to save local perturbations in. Defaults to None.

            augmenter (Optional[LocalTokenPertubator], optional):

                Function to augment data with perturbations, to generate neighborhood data. Defaults to None.

            labelset (Optional[Union[Sequence[str], LabelProvider]], optional): Sequence of label names or

                LabelProvider containing named labels. When not supplied, it uses identifiers for labels.

                Defaults to None.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        &quot;&quot;&quot;

        super().__init__()

        self.env = default_env(env)

        if augmenter is None:

            augmenter = TokenReplacement(env=self.env, detokenizer=default_detokenizer)

        if isinstance(labelset, LabelProvider) and hasattr(labelset, &#39;labelset&#39;):

            labelset = list(labelset.labelset)

        elif labelset is None and self.env is not None:

            if hasattr(self.env.labels, &#39;labelset&#39;):

                labelset = list(self.env.labels.labelset)

        self.labelset = labelset

        self.augmenter = augmenter

        self._seed = seed

    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed

class WeightedExplanation:

    def __init__(self, kernel: Optional[Callable] = None, kernel_width: Union[int, float] = 25):

        &quot;&quot;&quot;Add weights to neighborhood data.

        Args:

            kernel (Optional[Callable], optional):  Kernel to determine similarity of perturbed instances to original

                instance (if set to None defaults to `data.weights.exponential_kernel`). Defaults to None.

            kernel_width (Union[int, float], optional): Hyperparameter for similarity function of kernel.

                Defaults to 25.

        &quot;&quot;&quot;

        if kernel is None:

            kernel = exponential_kernel

        self.kernel_fn = lambda d: kernel(d, kernel_width)

    def weigh_samples(self, a, b=None, metric=&#39;cosine&#39;):

        if b is None:

            b = a[0]

        return self.kernel_fn(pairwise_distances(a, b, metric=metric))

class LIME(LocalExplanation, WeightedExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment],

                 local_model: Optional[LinearSurrogate] = None,

                 kernel: Optional[Callable] = None,

                 kernel_width: Union[int, float] = 25,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 seed: int = 0):

        &quot;&quot;&quot;Local Interpretable Model-Agnostic Explanations (`LIME`_).

        Implementation of local linear surrogate model on (weighted) perturbed text data,

        to get feature attribution scores for an example instance.

        Args:

            env (Optional[AbstractEnvironment]): Environment to save local perturbations in. Defaults to None.

            local_model (Optional[LinearSurrogate], optional): Local linear model. Defaults to None.

            kernel (Optional[Callable], optional):

                Kernel to determine similarity of perturbed instances to original instance. Defaults to None.

            kernel_width (Union[int, float], optional):

                Hyperparameter for similarity function of kernel. Defaults to 25.

            augmenter (Optional[LocalTokenPertubator], optional):

                Function to augment data with perturbations, to generate neighborhood data. Defaults to None.

            labelset (Optional[Union[Sequence[str], LabelProvider]], optional):

                Sequence of label names or LabelProvider containing named labels. When not supplied, it uses

                identifiers for labels. Defaults to None.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        .. _LIME:

            https://github.com/marcotcr/lime

        &quot;&quot;&quot;

        LocalExplanation.__init__(self, env=env, augmenter=augmenter, labelset=labelset, seed=seed)

        WeightedExplanation.__init__(self, kernel=kernel, kernel_width=kernel_width)

        if local_model is None:

            local_model = LinearSurrogate(Ridge(alpha=1, fit_intercept=True, random_state=self._seed))

        self.local_model = local_model

    @text_instance(tokenize=True)

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 labels: Optional[Union[Sequence[int], Sequence[str]]] = None,

                 n_samples: int = 50,

                 n_features: int = 10,

                 feature_selection_method: str = &#39;auto&#39;,

                 weigh_samples: bool = True,

                 distance_metric: str = &#39;cosine&#39;) -&gt; FeatureAttribution:

        &quot;&quot;&quot;Calculate feature attribution scores using `LIME Text`_.

        Args:

            sample (TextInstance): Instance to explain.

            model (AbstractClassifier): Model to explain.

            labels (Optional[Union[Sequence[int], Sequence[str]]], optional): [description]. Defaults to None.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            n_features (int, optional): Maximum number of features to include (explanation length). Defaults to 10.

            feature_selection_method (str, optional): Method for limiting number of features, either

                `forward_selection`, `highest_weights` or `auto`. Defaults to &#39;auto&#39;.

            weigh_samples (bool, optional): Whether to locally weigh samples based on their similarity to the original

                instance. Defaults to True.

            distance_metric (str, optional): Distance metric for local weighting. Defaults to &#39;cosine&#39;.

        Returns:

            FeatureAttribution: [description]

        .. _LIME Text:

            https://github.com/marcotcr/lime/blob/master/lime/lime_text.py

        &quot;&quot;&quot;

        if labels is not None:

            if isinstance(labels, (int, str)):

                labels = [labels]

            n_labels = sum(1 for _ in iter(labels))

            if n_labels &gt; 0 and isinstance(next(iter(labels)), str):

                assert self.labelset is not None, &#39;can only provide label names when such a list exists&#39;

                labels = [self.labelset.index(label) for label in labels]

        # Generate neighborhood samples

        provider, perturbed, y = self.augment_sample(sample, model, sequential=False,

                                                     contiguous=False, n_samples=n_samples)

        perturbed = binarize(perturbed)  # flatten all n replacements into one

        if weigh_samples:

            weights = self.weigh_samples(perturbed, metric=distance_metric)

        if feature_selection_method == &#39;auto&#39;:

            feature_selection_method = &#39;forward_selection&#39; if n_features &lt;= 6 else &#39;highest_weights&#39;

        feature_importances, used_features = [], {}

        if labels is None:

            labels = np.arange(y.shape[1])

        for label in labels:

            # Look at output for label

            y_label = y[:, label].copy()

            # Get the most important features

            features = FeatureSelector(self.local_model)(perturbed,

                                                         y_label,

                                                         weights=weights,

                                                         n_features=n_features,

                                                         method=feature_selection_method)

            # Fit explanation model

            self.local_model.alpha_reset()

            self.local_model.fit(perturbed[:, features], y_label, weights=weights)

            feature_importances.append(self.local_model.feature_importances)

            used_features[label] = features

        return FeatureAttribution(provider=provider,

                                  scores=feature_importances,

                                  used_features=used_features,

                                  labels=labels,

                                  labelset=self.labelset)

class KernelSHAP(LocalExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: LocalTokenPertubator = None,

                 seed: int = 0):

        &quot;&quot;&quot;Calculates `Shapley values`_ for an instance to explain, assuming the model is a black-box.

        Calculates Shapley values (local, additive feature attribution scores) for an instance

        to explain, by calculating the average contribution of changing combinations of feature

        values.

        Args:

            env (Optional[AbstractEnvironment], optional): Environment to save local perturbations in. Defaults to None.

            augmenter (Optional[LocalTokenPertubator], optional): Function to augment data with perturbations,

                to generate neighborhood data. Defaults to None.

            labelset (Optional[Union[Sequence[str], LabelProvider]], optional): Sequence of label names or

                LabelProvider containing named labels. When not supplied, it uses identifiers for labels.

                Defaults to None.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        .. _Shapley values:

            https://github.com/slundberg/shap

        &quot;&quot;&quot;

        super().__init__(env=env, augmenter=augmenter, labelset=labelset, seed=seed)

    @staticmethod

    def select_features(X: np.ndarray, y: np.ndarray, default_features: int = 1,

                        l1_reg: Union[int, float, str] = &#39;auto&#39;) -&gt; np.ndarray:

        &quot;&quot;&quot;Select features for data X and corresponding output y.

        Args:

            X (np.ndarray): Input data.

            y (np.ndarray): Prediction / ground-truth value for X.

            default_features (int, optional): Default number of features, when returning all features. Defaults to 1.

            l1_reg (Union[int, float, str], optional): Method for regularization, either `auto`, `n_features({int})`,

            `{int}`, `{float}`, `aic` or `bic`. Defaults to &#39;auto&#39;.

        Raises:

            Exception: Unknown value for `l1_reg`

        Returns:

            np.ndarray: Feature indices to include.

        &quot;&quot;&quot;

        feature_selector = FeatureSelector()

        nonzero = np.arange(default_features)

        if isinstance(l1_reg, str) and l1_reg.startswith(&#39;n_features(&#39;):

            l1_reg = int(l1_reg[len(&#39;n_features(&#39;):-1])

        if isinstance(l1_reg, int):

            nonzero = feature_selector(X, y, n_features=l1_reg, method=&#39;l1_reg&#39;)

        elif isinstance(l1_reg, float):

            nonzero = feature_selector(X, y, method=&#39;l1_reg&#39;, alpha=l1_reg)

        elif l1_reg in [&#39;auto&#39;, &#39;aic&#39;, &#39;bic&#39;]:

            if l1_reg == &#39;auto&#39;:

                l1_reg = &#39;aic&#39;

            nonzero = feature_selector(X, y, method=l1_reg)

        else:

            raise Exception(f&#39;Unknown value &quot;{l1_reg}&quot; for l1_reg&#39;)

        return nonzero

    @text_instance(tokenize=True)

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 n_samples: Optional[int] = None,

                 l1_reg: Union[int, float, str] = &#39;auto&#39;) -&gt; FeatureAttribution:

        &quot;&quot;&quot;Calculate feature attribution scores using `KernelShap`_.

        Args:

            sample (TextInstance): Instance to explain.

            model (AbstractClassifier): Model to explain.

            n_samples (Optional[int], optional): Number of neighborhood samples to generate (if None defaults

                to `2 * sample_len + 2 ** 11`). Defaults to None.

            l1_reg (Union[int, float, str], optional): Method for regularization (limiting number of features),

                either `auto`, `n_features({int})`, `{int}`, `{float}`, `aic` or `bic`. Defaults to &#39;auto&#39;.

        Returns:

            FeatureAttribution: [description]

        .. _KernelShap:

            https://github.com/slundberg/shap/blob/master/shap/explainers/_kernel.py

        &quot;&quot;&quot;

        sample_len = len(sample.tokenized)

        if n_samples is None:

            n_samples = 2 * sample_len + 2 ** 11

        n_samples = min(n_samples, 2 ** 30)

        provider, perturbed, y = self.augment_sample(sample, model, sequential=True,

                                                     contiguous=False, n_samples=n_samples,

                                                     add_background_instance=True)

        # To-do: exclude non-varying feature groups

        y_null, y = y[-1], y[1:-1]

        y -= y_null

        used_features = np.arange(perturbed.shape[1])

        phi = np.zeros([sample_len, y.shape[1]])

        phi_var = np.zeros(sample_len)

        if perturbed.shape[1] == 1:

            phi = np.mean(y - y_null, axis=0).reshape(1, -1)

        elif perturbed.shape[1] &gt; 1:

            # Weigh samples

            M = perturbed.shape[1]

            Z = np.sum(perturbed[1:-1], axis=1).astype(int)

            weight_vector = np.array([(M - 1) / (math.comb(M, m) * m * (M - m)) for m in range(1, M)])

            weight_vector /= np.sum(weight_vector)

            kernel_weights = weight_vector[Z - 1]

            nonzero = KernelSHAP.select_features(perturbed[1:-1], y, default_features=sample_len, l1_reg=l1_reg)

            used_features = nonzero

            phi_var = np.ones(sample_len)

            if len(used_features) &gt; 0:

                X = perturbed[1:-1]

                X_W = np.dot(X.T, np.diag(kernel_weights))

                try:

                    tmp2 = np.linalg.inv(np.dot(X_W, X))

                except np.linalg.LinAlgError:

                    tmp2 = np.linalg.pinv(np.dot(X_W, X))

                phi = np.dot(tmp2, np.dot(X_W, y)).T

        return FeatureAttribution(provider=provider,

                                  scores=phi,

                                  scores_stddev=phi_var,

                                  base_score=y_null,

                                  used_features=used_features,

                                  labels=np.arange(y.shape[1]),

                                  labelset=self.labelset)

class Anchor(LocalExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment],

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 seed: int = 0):

        super().__init__(env=env, augmenter=augmenter, labelset=labelset, seed=seed)

    @staticmethod

    def kl_bernoulli(p, q):

        p = float(min(1 - 1e-15, max(1e-15, p)))

        q = float(min(1 - 1e-15, max(1e-15, q)))

        return (p * np.log(p / q) + (1 - p) *

                np.log((1 - p) / (1 - q)))

    @staticmethod

    def dlow_bernoulli(p, level):

        lm = max(min(1, p - np.sqrt(level / 2.0)), 0.0)

        qm = (p + lm) / 2.0

        if Anchor.kl_bernoulli(p, qm) &gt; level:

            lm = qm

        return lm

    def generate_candidates(self,):

        pass

    def best_candidate(self):

        pass

    @staticmethod

    def beam_search(provider,

                    perturbed: np.ndarray,

                    model,

                    beam_size: int = 1,

                    min_confidence: float = 0.95,

                    delta: float = 0.05,

                    epsilon: float = 0.1,

                    max_anchor_size: Optional[int] = None,

                    batch_size: int = 20):

        assert beam_size &gt;= 1, f&#39;beam size should be at least 1, but is {beam_size}&#39;

        assert 0.0 &lt;= min_confidence &lt;= 0.95, f&#39;min_confidence should be a value in [0, 1], but is {min_confidence}&#39;

        assert 0.0 &lt;= delta &lt;= 0.95, f&#39;delta should be a value in [0, 1], but is {delta}&#39;

        assert 0.0 &lt;= epsilon &lt;= 0.95, f&#39;epsilon should be a value in [0, 1], but is {epsilon}&#39;

        assert batch_size &gt; 2, &#39;requires positive batch size&#39;

        for batch in provider.instance_chunker(batch_size):

            y = list(model.predict_proba_raw(batch))[-1][-1]  # todo: only look at probs of one class

            y_true, y = y[0], y[1:]  # noqa: F841

            beta = np.log(1.0 / delta)

            mean = y.mean()

            lb = Anchor.dlow_bernoulli(mean, beta / perturbed.shape[0])

            if not(mean &gt; min_confidence and lb &lt; min_confidence - epsilon):

                break

        raise NotImplementedError(&#39;[WIP] Implementing anchor/anchor_base.py&#39;)

    @text_instance

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 n_samples: int = 100,

                 beam_size: int = 1,

                 min_confidence: float = 0.95,

                 delta: float = 0.05,

                 epsilon: float = 0.1,

                 max_anchor_size: Optional[int] = None):

        raise NotImplementedError(&#39;Only partially implemented&#39;)

        # https://github.com/marcotcr/anchor/blob/master/anchor/anchor_text.py

        # https://github.com/marcotcr/anchor/blob/master/anchor/anchor_base.py

        provider, perturbed = self.augment_sample(sample, None, sequential=False,

                                                  contiguous=False, n_samples=n_samples,

                                                  predict=False)

        perturbed = binarize(perturbed[1:])  # flatten all n replacements into one

        y_true = np.argmax(model.predict_proba([provider[0]])[0][-1])  # noqa: F841

        # Use beam from https://homes.cs.washington.edu/~marcotcr/aaai18.pdf (Algorithm 2)

        anchor = Anchor.beam_search(provider,  # noqa: F841

                                    perturbed,

                                    model,

                                    beam_size=beam_size,

                                    min_confidence=min_confidence,

                                    delta=delta,

                                    epsilon=epsilon,

                                    max_anchor_size=max_anchor_size,

                                    batch_size=n_samples // 10 if n_samples &gt;= 1000 else n_samples // 5)

        pass

class LocalTree(LocalExplanation, WeightedExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 local_model: Optional[TreeSurrogate] = None,

                 kernel: Optional[Callable] = None,

                 kernel_width: Union[int, float] = 25,

                 explanation_type: str = &#39;multiclass&#39;,

                 seed: int = 0):

        LocalExplanation.__init__(self, env=env, augmenter=augmenter, labelset=labelset, seed=seed)

        WeightedExplanation.__init__(self, kernel=kernel, kernel_width=kernel_width)

        if local_model is None:

            local_model = TreeSurrogate(DecisionTreeClassifier(random_state=self._seed))

        self.local_model = local_model

        self.explanation_type = explanation_type

    @text_instance

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 n_samples: int = 50,

                 weigh_samples: bool = True,

                 distance_metric: str = &#39;cosine&#39;,

                 max_rule_size: Optional[int] = None,

                 **sample_kwargs):

        provider, perturbed, y = self.augment_sample(sample,

                                                     model,

                                                     n_samples=n_samples,

                                                     avoid_proba=True,

                                                     **sample_kwargs)

        perturbed = binarize(perturbed)  # flatten all n replacements into one

        weights = self.weigh_samples(perturbed, metric=distance_metric) if weigh_samples else None

        self.local_model.max_rule_size = max_rule_size

        self.local_model.fit(perturbed, y, weights=weights)

        return Rules(provider=provider,

                     rules=self.local_model,

                     labelset=self.labelset,

                     sampled=True)

class FactFoilMixin:

    def to_fact_foil(self, y, labelset, foil_fn: Union[FactFoilEncoder, int, str]):

        if isinstance(foil_fn, str):

            foil_fn = FactFoilEncoder.from_str(foil_fn, labelset)

        elif isinstance(foil_fn, int):

            foil_fn = FactFoilEncoder(foil_fn, labelset)

        return foil_fn(y)

class FoilTree(FactFoilMixin, LocalExplanation, WeightedExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 local_model: Optional[TreeSurrogate] = None,

                 kernel: Optional[Callable] = None,

                 kernel_width: Union[int, float] = 25,

                 explanation_type: str = &#39;multiclass&#39;,

                 seed: int = 0):

        LocalExplanation.__init__(self, env=env, augmenter=augmenter, labelset=labelset, seed=seed)

        WeightedExplanation.__init__(self, kernel=kernel, kernel_width=kernel_width)

        if local_model is None:

            local_model = TreeSurrogate(DecisionTreeClassifier(random_state=self._seed))

        self.local_model = local_model

        self.explanation_type = explanation_type

    @text_instance

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 foil_fn: Union[FactFoilEncoder, int, str],

                 n_samples: int = 50,

                 weigh_samples: bool = True,

                 distance_metric: str = &#39;cosine&#39;,

                 max_rule_size: Optional[int] = None,

                 **sample_kwargs):

        provider, perturbed, y = self.augment_sample(sample,

                                                     model,

                                                     n_samples=n_samples,

                                                     avoid_proba=True,

                                                     **sample_kwargs)

        perturbed = binarize(perturbed)  # flatten all n replacements into one

        # Encode foil as 0 and rest as 1

        labelset = self.labelset if self.labelset else model

        y_ = self.to_fact_foil(y, labelset, foil_fn)

        weights = self.weigh_samples(perturbed, metric=distance_metric) if weigh_samples else None

        self.local_model.max_rule_size = max_rule_size

        self.local_model.fit(perturbed, y_, weights=weights)

        # TODO: pass to which label the Foil Tree applies

        return Rules(provider=provider,

                     rules=self.local_model,

                     labelset=labelset,

                     sampled=True)

class LocalRules(FactFoilMixin, LocalExplanation, WeightedExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 local_model: Optional[RuleSurrogate] = None,

                 kernel: Optional[Callable] = None,

                 kernel_width: Union[int, float] = 25,

                 explanation_type: str = &#39;multiclass&#39;,

                 seed: int = 0):

        LocalExplanation.__init__(self, env=env, augmenter=augmenter, labelset=labelset, seed=seed)

        WeightedExplanation.__init__(self, kernel=kernel, kernel_width=kernel_width)

        if local_model is None:

            local_model = RuleSurrogate(SkopeRules(max_depth_duplication=2,

                                                   n_estimators=30,

                                                   random_state=self._seed))

        self.local_model = local_model

        self.explanation_type = explanation_type

    @text_instance

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 foil_fn: Union[FactFoilEncoder, int, str],

                 n_samples: int = 50,

                 weigh_samples: bool = True,

                 distance_metric: str = &#39;cosine&#39;,

                 **sample_kwargs):

        provider, perturbed, y = self.augment_sample(sample,

                                                     model,

                                                     n_samples=n_samples,

                                                     avoid_proba=True,

                                                     **sample_kwargs)

        perturbed = binarize(perturbed)  # flatten all n replacements into one

        # Encode foil as 0 and rest as 1

        labelset = self.labelset if self.labelset else model

        y_ = self.to_fact_foil(y, labelset, foil_fn)

        weights = self.weigh_samples(perturbed, metric=distance_metric) if weigh_samples else None

        self.local_model.fit(perturbed, y_, weights=weights)

        return Rules(provider,

                     rules=self.local_model,

                     labelset=labelset,

                     sampled=True)
</code></pre></div>
</td></tr></table>
</details>
<h2 id="functions">Functions</h2>
<h3 id="default_env">default_env</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">default_env</span><span class="p">(</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span>
</code></pre></div>
</td></tr></table>
<p>If no environment is supplied, an empty Enviroment is created for text data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>env</td>
<td>Optional[AbstractEnvironment]</td>
<td>If a environment is supplied, it is used, otherwise.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>AbstractEnvironment</td>
<td>The default/supplied environment.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>def default_env(env: Optional[AbstractEnvironment] = None) -&gt; AbstractEnvironment:

    &quot;&quot;&quot;If no environment is supplied, an empty Enviroment is created for text data.

    Args:

        env (Optional[AbstractEnvironment], optional): If a environment is supplied, it is used, otherwise.

    Returns:

        AbstractEnvironment: The default/supplied environment.

    &quot;&quot;&quot;

    if env is not None:

        return env

    empty_dataset = TextInstanceProvider([])

    empty_labels = MemoryLabelProvider([], {})

    empty_env = TextEnvironment(empty_dataset, empty_labels)

    return empty_env
</code></pre></div>
</td></tr></table>
</details>
<h2 id="classes">Classes</h2>
<h3 id="anchor">Anchor</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Anchor</span><span class="p">(</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span><span class="p">],</span>
    <span class="n">labelset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">augmenter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">LocalTokenPertubator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class Anchor(LocalExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment],

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 seed: int = 0):

        super().__init__(env=env, augmenter=augmenter, labelset=labelset, seed=seed)

    @staticmethod

    def kl_bernoulli(p, q):

        p = float(min(1 - 1e-15, max(1e-15, p)))

        q = float(min(1 - 1e-15, max(1e-15, q)))

        return (p * np.log(p / q) + (1 - p) *

                np.log((1 - p) / (1 - q)))

    @staticmethod

    def dlow_bernoulli(p, level):

        lm = max(min(1, p - np.sqrt(level / 2.0)), 0.0)

        qm = (p + lm) / 2.0

        if Anchor.kl_bernoulli(p, qm) &gt; level:

            lm = qm

        return lm

    def generate_candidates(self,):

        pass

    def best_candidate(self):

        pass

    @staticmethod

    def beam_search(provider,

                    perturbed: np.ndarray,

                    model,

                    beam_size: int = 1,

                    min_confidence: float = 0.95,

                    delta: float = 0.05,

                    epsilon: float = 0.1,

                    max_anchor_size: Optional[int] = None,

                    batch_size: int = 20):

        assert beam_size &gt;= 1, f&#39;beam size should be at least 1, but is {beam_size}&#39;

        assert 0.0 &lt;= min_confidence &lt;= 0.95, f&#39;min_confidence should be a value in [0, 1], but is {min_confidence}&#39;

        assert 0.0 &lt;= delta &lt;= 0.95, f&#39;delta should be a value in [0, 1], but is {delta}&#39;

        assert 0.0 &lt;= epsilon &lt;= 0.95, f&#39;epsilon should be a value in [0, 1], but is {epsilon}&#39;

        assert batch_size &gt; 2, &#39;requires positive batch size&#39;

        for batch in provider.instance_chunker(batch_size):

            y = list(model.predict_proba_raw(batch))[-1][-1]  # todo: only look at probs of one class

            y_true, y = y[0], y[1:]  # noqa: F841

            beta = np.log(1.0 / delta)

            mean = y.mean()

            lb = Anchor.dlow_bernoulli(mean, beta / perturbed.shape[0])

            if not(mean &gt; min_confidence and lb &lt; min_confidence - epsilon):

                break

        raise NotImplementedError(&#39;[WIP] Implementing anchor/anchor_base.py&#39;)

    @text_instance

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 n_samples: int = 100,

                 beam_size: int = 1,

                 min_confidence: float = 0.95,

                 delta: float = 0.05,

                 epsilon: float = 0.1,

                 max_anchor_size: Optional[int] = None):

        raise NotImplementedError(&#39;Only partially implemented&#39;)

        # https://github.com/marcotcr/anchor/blob/master/anchor/anchor_text.py

        # https://github.com/marcotcr/anchor/blob/master/anchor/anchor_base.py

        provider, perturbed = self.augment_sample(sample, None, sequential=False,

                                                  contiguous=False, n_samples=n_samples,

                                                  predict=False)

        perturbed = binarize(perturbed[1:])  # flatten all n replacements into one

        y_true = np.argmax(model.predict_proba([provider[0]])[0][-1])  # noqa: F841

        # Use beam from https://homes.cs.washington.edu/~marcotcr/aaai18.pdf (Algorithm 2)

        anchor = Anchor.beam_search(provider,  # noqa: F841

                                    perturbed,

                                    model,

                                    beam_size=beam_size,

                                    min_confidence=min_confidence,

                                    delta=delta,

                                    epsilon=epsilon,

                                    max_anchor_size=max_anchor_size,

                                    batch_size=n_samples // 10 if n_samples &gt;= 1000 else n_samples // 5)

        pass
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.local_explanation.LocalExplanation</li>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="static-methods">Static methods</h4>
<h4 id="beam_search">beam_search</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">beam_search</span><span class="p">(</span>
    <span class="n">provider</span><span class="p">,</span>
    <span class="n">perturbed</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">model</span><span class="p">,</span>
    <span class="n">beam_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">min_confidence</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">,</span>
    <span class="n">delta</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">epsilon</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
    <span class="n">max_anchor_size</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @staticmethod

    def beam_search(provider,

                    perturbed: np.ndarray,

                    model,

                    beam_size: int = 1,

                    min_confidence: float = 0.95,

                    delta: float = 0.05,

                    epsilon: float = 0.1,

                    max_anchor_size: Optional[int] = None,

                    batch_size: int = 20):

        assert beam_size &gt;= 1, f&#39;beam size should be at least 1, but is {beam_size}&#39;

        assert 0.0 &lt;= min_confidence &lt;= 0.95, f&#39;min_confidence should be a value in [0, 1], but is {min_confidence}&#39;

        assert 0.0 &lt;= delta &lt;= 0.95, f&#39;delta should be a value in [0, 1], but is {delta}&#39;

        assert 0.0 &lt;= epsilon &lt;= 0.95, f&#39;epsilon should be a value in [0, 1], but is {epsilon}&#39;

        assert batch_size &gt; 2, &#39;requires positive batch size&#39;

        for batch in provider.instance_chunker(batch_size):

            y = list(model.predict_proba_raw(batch))[-1][-1]  # todo: only look at probs of one class

            y_true, y = y[0], y[1:]  # noqa: F841

            beta = np.log(1.0 / delta)

            mean = y.mean()

            lb = Anchor.dlow_bernoulli(mean, beta / perturbed.shape[0])

            if not(mean &gt; min_confidence and lb &lt; min_confidence - epsilon):

                break

        raise NotImplementedError(&#39;[WIP] Implementing anchor/anchor_base.py&#39;)
</code></pre></div>
</td></tr></table>
</details>
<h4 id="dlow_bernoulli">dlow_bernoulli</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">dlow_bernoulli</span><span class="p">(</span>
    <span class="n">p</span><span class="p">,</span>
    <span class="n">level</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @staticmethod

    def dlow_bernoulli(p, level):

        lm = max(min(1, p - np.sqrt(level / 2.0)), 0.0)

        qm = (p + lm) / 2.0

        if Anchor.kl_bernoulli(p, qm) &gt; level:

            lm = qm

        return lm
</code></pre></div>
</td></tr></table>
</details>
<h4 id="kl_bernoulli">kl_bernoulli</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">kl_bernoulli</span><span class="p">(</span>
    <span class="n">p</span><span class="p">,</span>
    <span class="n">q</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @staticmethod

    def kl_bernoulli(p, q):

        p = float(min(1 - 1e-15, max(1e-15, p)))

        q = float(min(1 - 1e-15, max(1e-15, q)))

        return (p * np.log(p / q) + (1 - p) *

                np.log((1 - p) / (1 - q)))
</code></pre></div>
</td></tr></table>
</details>
<h4 id="methods">Methods</h4>
<h4 id="augment_sample">augment_sample</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">augment_sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">TextInstance</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">machinelearning</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractClassifier</span><span class="p">,</span>
    <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">add_background_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">predict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">avoid_proba</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Augment a single sample to generate neighborhood data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample</td>
<td>TextInstance</td>
<td>Instance to perturb.</td>
<td>None</td>
</tr>
<tr>
<td>model</td>
<td>AbstractClassifier</td>
<td>Model to provide predictions for neighborhood data.</td>
<td>None</td>
</tr>
<tr>
<td>sequential</td>
<td>bool</td>
<td>Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>contiguous</td>
<td>bool</td>
<td>Whether to apply perturbations on contiguous stretches of text. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>n_samples</td>
<td>int</td>
<td>Number of neighborhood samples to generate. Defaults to 50.</td>
<td>50</td>
</tr>
<tr>
<td>add_background_instance</td>
<td>bool</td>
<td>Add an additional instance with all tokens replaced. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>predict</td>
<td>bool</td>
<td>Defaults to True.</td>
<td>None</td>
</tr>
<tr>
<td>avoid_proba</td>
<td>bool</td>
<td>Model predictions als labels (True) or probabilities when available (False).</td>
<td></td>
</tr>
<tr>
<td>Defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]</td>
<td>Provider, how instances were perturbed and optionally the corresponding predictions for each instance.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed
</code></pre></div>
</td></tr></table>
</details>
<h4 id="best_candidate">best_candidate</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">best_candidate</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def best_candidate(self):

        pass
</code></pre></div>
</td></tr></table>
</details>
<h4 id="generate_candidates">generate_candidates</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">generate_candidates</span><span class="p">(</span>
    <span class="bp">self</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def generate_candidates(self,):

        pass
</code></pre></div>
</td></tr></table>
</details>
<h3 id="factfoilmixin">FactFoilMixin</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">FactFoilMixin</span><span class="p">(</span>
    <span class="o">/</span><span class="p">,</span>
    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class FactFoilMixin:

    def to_fact_foil(self, y, labelset, foil_fn: Union[FactFoilEncoder, int, str]):

        if isinstance(foil_fn, str):

            foil_fn = FactFoilEncoder.from_str(foil_fn, labelset)

        elif isinstance(foil_fn, int):

            foil_fn = FactFoilEncoder(foil_fn, labelset)

        return foil_fn(y)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="descendants">Descendants</h4>
<ul>
<li>text_explainability.local_explanation.FoilTree</li>
<li>text_explainability.local_explanation.LocalRules</li>
</ul>
<h4 id="methods_1">Methods</h4>
<h4 id="to_fact_foil">to_fact_foil</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_fact_foil</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">,</span>
    <span class="n">foil_fn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">target_encoding</span><span class="o">.</span><span class="n">FactFoilEncoder</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def to_fact_foil(self, y, labelset, foil_fn: Union[FactFoilEncoder, int, str]):

        if isinstance(foil_fn, str):

            foil_fn = FactFoilEncoder.from_str(foil_fn, labelset)

        elif isinstance(foil_fn, int):

            foil_fn = FactFoilEncoder(foil_fn, labelset)

        return foil_fn(y)
</code></pre></div>
</td></tr></table>
</details>
<h3 id="foiltree">FoilTree</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">FoilTree</span><span class="p">(</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">augmenter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">LocalTokenPertubator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">local_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">surrogate</span><span class="o">.</span><span class="n">TreeSurrogate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">explanation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;multiclass&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class FoilTree(FactFoilMixin, LocalExplanation, WeightedExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 local_model: Optional[TreeSurrogate] = None,

                 kernel: Optional[Callable] = None,

                 kernel_width: Union[int, float] = 25,

                 explanation_type: str = &#39;multiclass&#39;,

                 seed: int = 0):

        LocalExplanation.__init__(self, env=env, augmenter=augmenter, labelset=labelset, seed=seed)

        WeightedExplanation.__init__(self, kernel=kernel, kernel_width=kernel_width)

        if local_model is None:

            local_model = TreeSurrogate(DecisionTreeClassifier(random_state=self._seed))

        self.local_model = local_model

        self.explanation_type = explanation_type

    @text_instance

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 foil_fn: Union[FactFoilEncoder, int, str],

                 n_samples: int = 50,

                 weigh_samples: bool = True,

                 distance_metric: str = &#39;cosine&#39;,

                 max_rule_size: Optional[int] = None,

                 **sample_kwargs):

        provider, perturbed, y = self.augment_sample(sample,

                                                     model,

                                                     n_samples=n_samples,

                                                     avoid_proba=True,

                                                     **sample_kwargs)

        perturbed = binarize(perturbed)  # flatten all n replacements into one

        # Encode foil as 0 and rest as 1

        labelset = self.labelset if self.labelset else model

        y_ = self.to_fact_foil(y, labelset, foil_fn)

        weights = self.weigh_samples(perturbed, metric=distance_metric) if weigh_samples else None

        self.local_model.max_rule_size = max_rule_size

        self.local_model.fit(perturbed, y_, weights=weights)

        # TODO: pass to which label the Foil Tree applies

        return Rules(provider=provider,

                     rules=self.local_model,

                     labelset=labelset,

                     sampled=True)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_1">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.local_explanation.FactFoilMixin</li>
<li>text_explainability.local_explanation.LocalExplanation</li>
<li>text_explainability.default.Readable</li>
<li>text_explainability.local_explanation.WeightedExplanation</li>
</ul>
<h4 id="methods_2">Methods</h4>
<h4 id="augment_sample_1">augment_sample</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">augment_sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">TextInstance</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">machinelearning</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractClassifier</span><span class="p">,</span>
    <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">add_background_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">predict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">avoid_proba</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Augment a single sample to generate neighborhood data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample</td>
<td>TextInstance</td>
<td>Instance to perturb.</td>
<td>None</td>
</tr>
<tr>
<td>model</td>
<td>AbstractClassifier</td>
<td>Model to provide predictions for neighborhood data.</td>
<td>None</td>
</tr>
<tr>
<td>sequential</td>
<td>bool</td>
<td>Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>contiguous</td>
<td>bool</td>
<td>Whether to apply perturbations on contiguous stretches of text. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>n_samples</td>
<td>int</td>
<td>Number of neighborhood samples to generate. Defaults to 50.</td>
<td>50</td>
</tr>
<tr>
<td>add_background_instance</td>
<td>bool</td>
<td>Add an additional instance with all tokens replaced. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>predict</td>
<td>bool</td>
<td>Defaults to True.</td>
<td>None</td>
</tr>
<tr>
<td>avoid_proba</td>
<td>bool</td>
<td>Model predictions als labels (True) or probabilities when available (False).</td>
<td></td>
</tr>
<tr>
<td>Defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]</td>
<td>Provider, how instances were perturbed and optionally the corresponding predictions for each instance.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed
</code></pre></div>
</td></tr></table>
</details>
<h4 id="to_fact_foil_1">to_fact_foil</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_fact_foil</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">,</span>
    <span class="n">foil_fn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">target_encoding</span><span class="o">.</span><span class="n">FactFoilEncoder</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def to_fact_foil(self, y, labelset, foil_fn: Union[FactFoilEncoder, int, str]):

        if isinstance(foil_fn, str):

            foil_fn = FactFoilEncoder.from_str(foil_fn, labelset)

        elif isinstance(foil_fn, int):

            foil_fn = FactFoilEncoder(foil_fn, labelset)

        return foil_fn(y)
</code></pre></div>
</td></tr></table>
</details>
<h4 id="weigh_samples">weigh_samples</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">weigh_samples</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def weigh_samples(self, a, b=None, metric=&#39;cosine&#39;):

        if b is None:

            b = a[0]

        return self.kernel_fn(pairwise_distances(a, b, metric=metric))
</code></pre></div>
</td></tr></table>
</details>
<h3 id="kernelshap">KernelSHAP</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">KernelSHAP</span><span class="p">(</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">augmenter</span><span class="p">:</span> <span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">LocalTokenPertubator</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class KernelSHAP(LocalExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: LocalTokenPertubator = None,

                 seed: int = 0):

        &quot;&quot;&quot;Calculates `Shapley values`_ for an instance to explain, assuming the model is a black-box.

        Calculates Shapley values (local, additive feature attribution scores) for an instance

        to explain, by calculating the average contribution of changing combinations of feature

        values.

        Args:

            env (Optional[AbstractEnvironment], optional): Environment to save local perturbations in. Defaults to None.

            augmenter (Optional[LocalTokenPertubator], optional): Function to augment data with perturbations,

                to generate neighborhood data. Defaults to None.

            labelset (Optional[Union[Sequence[str], LabelProvider]], optional): Sequence of label names or

                LabelProvider containing named labels. When not supplied, it uses identifiers for labels.

                Defaults to None.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        .. _Shapley values:

            https://github.com/slundberg/shap

        &quot;&quot;&quot;

        super().__init__(env=env, augmenter=augmenter, labelset=labelset, seed=seed)

    @staticmethod

    def select_features(X: np.ndarray, y: np.ndarray, default_features: int = 1,

                        l1_reg: Union[int, float, str] = &#39;auto&#39;) -&gt; np.ndarray:

        &quot;&quot;&quot;Select features for data X and corresponding output y.

        Args:

            X (np.ndarray): Input data.

            y (np.ndarray): Prediction / ground-truth value for X.

            default_features (int, optional): Default number of features, when returning all features. Defaults to 1.

            l1_reg (Union[int, float, str], optional): Method for regularization, either `auto`, `n_features({int})`,

            `{int}`, `{float}`, `aic` or `bic`. Defaults to &#39;auto&#39;.

        Raises:

            Exception: Unknown value for `l1_reg`

        Returns:

            np.ndarray: Feature indices to include.

        &quot;&quot;&quot;

        feature_selector = FeatureSelector()

        nonzero = np.arange(default_features)

        if isinstance(l1_reg, str) and l1_reg.startswith(&#39;n_features(&#39;):

            l1_reg = int(l1_reg[len(&#39;n_features(&#39;):-1])

        if isinstance(l1_reg, int):

            nonzero = feature_selector(X, y, n_features=l1_reg, method=&#39;l1_reg&#39;)

        elif isinstance(l1_reg, float):

            nonzero = feature_selector(X, y, method=&#39;l1_reg&#39;, alpha=l1_reg)

        elif l1_reg in [&#39;auto&#39;, &#39;aic&#39;, &#39;bic&#39;]:

            if l1_reg == &#39;auto&#39;:

                l1_reg = &#39;aic&#39;

            nonzero = feature_selector(X, y, method=l1_reg)

        else:

            raise Exception(f&#39;Unknown value &quot;{l1_reg}&quot; for l1_reg&#39;)

        return nonzero

    @text_instance(tokenize=True)

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 n_samples: Optional[int] = None,

                 l1_reg: Union[int, float, str] = &#39;auto&#39;) -&gt; FeatureAttribution:

        &quot;&quot;&quot;Calculate feature attribution scores using `KernelShap`_.

        Args:

            sample (TextInstance): Instance to explain.

            model (AbstractClassifier): Model to explain.

            n_samples (Optional[int], optional): Number of neighborhood samples to generate (if None defaults

                to `2 * sample_len + 2 ** 11`). Defaults to None.

            l1_reg (Union[int, float, str], optional): Method for regularization (limiting number of features),

                either `auto`, `n_features({int})`, `{int}`, `{float}`, `aic` or `bic`. Defaults to &#39;auto&#39;.

        Returns:

            FeatureAttribution: [description]

        .. _KernelShap:

            https://github.com/slundberg/shap/blob/master/shap/explainers/_kernel.py

        &quot;&quot;&quot;

        sample_len = len(sample.tokenized)

        if n_samples is None:

            n_samples = 2 * sample_len + 2 ** 11

        n_samples = min(n_samples, 2 ** 30)

        provider, perturbed, y = self.augment_sample(sample, model, sequential=True,

                                                     contiguous=False, n_samples=n_samples,

                                                     add_background_instance=True)

        # To-do: exclude non-varying feature groups

        y_null, y = y[-1], y[1:-1]

        y -= y_null

        used_features = np.arange(perturbed.shape[1])

        phi = np.zeros([sample_len, y.shape[1]])

        phi_var = np.zeros(sample_len)

        if perturbed.shape[1] == 1:

            phi = np.mean(y - y_null, axis=0).reshape(1, -1)

        elif perturbed.shape[1] &gt; 1:

            # Weigh samples

            M = perturbed.shape[1]

            Z = np.sum(perturbed[1:-1], axis=1).astype(int)

            weight_vector = np.array([(M - 1) / (math.comb(M, m) * m * (M - m)) for m in range(1, M)])

            weight_vector /= np.sum(weight_vector)

            kernel_weights = weight_vector[Z - 1]

            nonzero = KernelSHAP.select_features(perturbed[1:-1], y, default_features=sample_len, l1_reg=l1_reg)

            used_features = nonzero

            phi_var = np.ones(sample_len)

            if len(used_features) &gt; 0:

                X = perturbed[1:-1]

                X_W = np.dot(X.T, np.diag(kernel_weights))

                try:

                    tmp2 = np.linalg.inv(np.dot(X_W, X))

                except np.linalg.LinAlgError:

                    tmp2 = np.linalg.pinv(np.dot(X_W, X))

                phi = np.dot(tmp2, np.dot(X_W, y)).T

        return FeatureAttribution(provider=provider,

                                  scores=phi,

                                  scores_stddev=phi_var,

                                  base_score=y_null,

                                  used_features=used_features,

                                  labels=np.arange(y.shape[1]),

                                  labelset=self.labelset)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_2">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.local_explanation.LocalExplanation</li>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="static-methods_1">Static methods</h4>
<h4 id="select_features">select_features</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">select_features</span><span class="p">(</span>
    <span class="n">X</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">default_features</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="n">l1_reg</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span>
</code></pre></div>
</td></tr></table>
<p>Select features for data X and corresponding output y.</p>
<p>Args:
    X (np.ndarray): Input data.
    y (np.ndarray): Prediction / ground-truth value for X.
    default_features (int, optional): Default number of features, when returning all features. Defaults to 1.
    l1_reg (Union[int, float, str], optional): Method for regularization, either <code>auto</code>, <code>n_features({int})</code>,
    <code>{int}</code>, <code>{float}</code>, <code>aic</code> or <code>bic</code>. Defaults to 'auto'.</p>
<p>Raises:
    Exception: Unknown value for <code>l1_reg</code></p>
<p>Returns:
    np.ndarray: Feature indices to include.</p>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @staticmethod

    def select_features(X: np.ndarray, y: np.ndarray, default_features: int = 1,

                        l1_reg: Union[int, float, str] = &#39;auto&#39;) -&gt; np.ndarray:

        &quot;&quot;&quot;Select features for data X and corresponding output y.

        Args:

            X (np.ndarray): Input data.

            y (np.ndarray): Prediction / ground-truth value for X.

            default_features (int, optional): Default number of features, when returning all features. Defaults to 1.

            l1_reg (Union[int, float, str], optional): Method for regularization, either `auto`, `n_features({int})`,

            `{int}`, `{float}`, `aic` or `bic`. Defaults to &#39;auto&#39;.

        Raises:

            Exception: Unknown value for `l1_reg`

        Returns:

            np.ndarray: Feature indices to include.

        &quot;&quot;&quot;

        feature_selector = FeatureSelector()

        nonzero = np.arange(default_features)

        if isinstance(l1_reg, str) and l1_reg.startswith(&#39;n_features(&#39;):

            l1_reg = int(l1_reg[len(&#39;n_features(&#39;):-1])

        if isinstance(l1_reg, int):

            nonzero = feature_selector(X, y, n_features=l1_reg, method=&#39;l1_reg&#39;)

        elif isinstance(l1_reg, float):

            nonzero = feature_selector(X, y, method=&#39;l1_reg&#39;, alpha=l1_reg)

        elif l1_reg in [&#39;auto&#39;, &#39;aic&#39;, &#39;bic&#39;]:

            if l1_reg == &#39;auto&#39;:

                l1_reg = &#39;aic&#39;

            nonzero = feature_selector(X, y, method=l1_reg)

        else:

            raise Exception(f&#39;Unknown value &quot;{l1_reg}&quot; for l1_reg&#39;)

        return nonzero
</code></pre></div>
</td></tr></table>
</details>
<h4 id="methods_3">Methods</h4>
<h4 id="augment_sample_2">augment_sample</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">augment_sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">TextInstance</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">machinelearning</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractClassifier</span><span class="p">,</span>
    <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">add_background_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">predict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">avoid_proba</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Augment a single sample to generate neighborhood data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample</td>
<td>TextInstance</td>
<td>Instance to perturb.</td>
<td>None</td>
</tr>
<tr>
<td>model</td>
<td>AbstractClassifier</td>
<td>Model to provide predictions for neighborhood data.</td>
<td>None</td>
</tr>
<tr>
<td>sequential</td>
<td>bool</td>
<td>Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>contiguous</td>
<td>bool</td>
<td>Whether to apply perturbations on contiguous stretches of text. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>n_samples</td>
<td>int</td>
<td>Number of neighborhood samples to generate. Defaults to 50.</td>
<td>50</td>
</tr>
<tr>
<td>add_background_instance</td>
<td>bool</td>
<td>Add an additional instance with all tokens replaced. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>predict</td>
<td>bool</td>
<td>Defaults to True.</td>
<td>None</td>
</tr>
<tr>
<td>avoid_proba</td>
<td>bool</td>
<td>Model predictions als labels (True) or probabilities when available (False).</td>
<td></td>
</tr>
<tr>
<td>Defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]</td>
<td>Provider, how instances were perturbed and optionally the corresponding predictions for each instance.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed
</code></pre></div>
</td></tr></table>
</details>
<h3 id="lime">LIME</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LIME</span><span class="p">(</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span><span class="p">],</span>
    <span class="n">local_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">surrogate</span><span class="o">.</span><span class="n">LinearSurrogate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">augmenter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">LocalTokenPertubator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class LIME(LocalExplanation, WeightedExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment],

                 local_model: Optional[LinearSurrogate] = None,

                 kernel: Optional[Callable] = None,

                 kernel_width: Union[int, float] = 25,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 seed: int = 0):

        &quot;&quot;&quot;Local Interpretable Model-Agnostic Explanations (`LIME`_).

        Implementation of local linear surrogate model on (weighted) perturbed text data,

        to get feature attribution scores for an example instance.

        Args:

            env (Optional[AbstractEnvironment]): Environment to save local perturbations in. Defaults to None.

            local_model (Optional[LinearSurrogate], optional): Local linear model. Defaults to None.

            kernel (Optional[Callable], optional):

                Kernel to determine similarity of perturbed instances to original instance. Defaults to None.

            kernel_width (Union[int, float], optional):

                Hyperparameter for similarity function of kernel. Defaults to 25.

            augmenter (Optional[LocalTokenPertubator], optional):

                Function to augment data with perturbations, to generate neighborhood data. Defaults to None.

            labelset (Optional[Union[Sequence[str], LabelProvider]], optional):

                Sequence of label names or LabelProvider containing named labels. When not supplied, it uses

                identifiers for labels. Defaults to None.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        .. _LIME:

            https://github.com/marcotcr/lime

        &quot;&quot;&quot;

        LocalExplanation.__init__(self, env=env, augmenter=augmenter, labelset=labelset, seed=seed)

        WeightedExplanation.__init__(self, kernel=kernel, kernel_width=kernel_width)

        if local_model is None:

            local_model = LinearSurrogate(Ridge(alpha=1, fit_intercept=True, random_state=self._seed))

        self.local_model = local_model

    @text_instance(tokenize=True)

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 labels: Optional[Union[Sequence[int], Sequence[str]]] = None,

                 n_samples: int = 50,

                 n_features: int = 10,

                 feature_selection_method: str = &#39;auto&#39;,

                 weigh_samples: bool = True,

                 distance_metric: str = &#39;cosine&#39;) -&gt; FeatureAttribution:

        &quot;&quot;&quot;Calculate feature attribution scores using `LIME Text`_.

        Args:

            sample (TextInstance): Instance to explain.

            model (AbstractClassifier): Model to explain.

            labels (Optional[Union[Sequence[int], Sequence[str]]], optional): [description]. Defaults to None.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            n_features (int, optional): Maximum number of features to include (explanation length). Defaults to 10.

            feature_selection_method (str, optional): Method for limiting number of features, either

                `forward_selection`, `highest_weights` or `auto`. Defaults to &#39;auto&#39;.

            weigh_samples (bool, optional): Whether to locally weigh samples based on their similarity to the original

                instance. Defaults to True.

            distance_metric (str, optional): Distance metric for local weighting. Defaults to &#39;cosine&#39;.

        Returns:

            FeatureAttribution: [description]

        .. _LIME Text:

            https://github.com/marcotcr/lime/blob/master/lime/lime_text.py

        &quot;&quot;&quot;

        if labels is not None:

            if isinstance(labels, (int, str)):

                labels = [labels]

            n_labels = sum(1 for _ in iter(labels))

            if n_labels &gt; 0 and isinstance(next(iter(labels)), str):

                assert self.labelset is not None, &#39;can only provide label names when such a list exists&#39;

                labels = [self.labelset.index(label) for label in labels]

        # Generate neighborhood samples

        provider, perturbed, y = self.augment_sample(sample, model, sequential=False,

                                                     contiguous=False, n_samples=n_samples)

        perturbed = binarize(perturbed)  # flatten all n replacements into one

        if weigh_samples:

            weights = self.weigh_samples(perturbed, metric=distance_metric)

        if feature_selection_method == &#39;auto&#39;:

            feature_selection_method = &#39;forward_selection&#39; if n_features &lt;= 6 else &#39;highest_weights&#39;

        feature_importances, used_features = [], {}

        if labels is None:

            labels = np.arange(y.shape[1])

        for label in labels:

            # Look at output for label

            y_label = y[:, label].copy()

            # Get the most important features

            features = FeatureSelector(self.local_model)(perturbed,

                                                         y_label,

                                                         weights=weights,

                                                         n_features=n_features,

                                                         method=feature_selection_method)

            # Fit explanation model

            self.local_model.alpha_reset()

            self.local_model.fit(perturbed[:, features], y_label, weights=weights)

            feature_importances.append(self.local_model.feature_importances)

            used_features[label] = features

        return FeatureAttribution(provider=provider,

                                  scores=feature_importances,

                                  used_features=used_features,

                                  labels=labels,

                                  labelset=self.labelset)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_3">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.local_explanation.LocalExplanation</li>
<li>text_explainability.default.Readable</li>
<li>text_explainability.local_explanation.WeightedExplanation</li>
</ul>
<h4 id="methods_4">Methods</h4>
<h4 id="augment_sample_3">augment_sample</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">augment_sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">TextInstance</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">machinelearning</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractClassifier</span><span class="p">,</span>
    <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">add_background_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">predict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">avoid_proba</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Augment a single sample to generate neighborhood data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample</td>
<td>TextInstance</td>
<td>Instance to perturb.</td>
<td>None</td>
</tr>
<tr>
<td>model</td>
<td>AbstractClassifier</td>
<td>Model to provide predictions for neighborhood data.</td>
<td>None</td>
</tr>
<tr>
<td>sequential</td>
<td>bool</td>
<td>Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>contiguous</td>
<td>bool</td>
<td>Whether to apply perturbations on contiguous stretches of text. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>n_samples</td>
<td>int</td>
<td>Number of neighborhood samples to generate. Defaults to 50.</td>
<td>50</td>
</tr>
<tr>
<td>add_background_instance</td>
<td>bool</td>
<td>Add an additional instance with all tokens replaced. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>predict</td>
<td>bool</td>
<td>Defaults to True.</td>
<td>None</td>
</tr>
<tr>
<td>avoid_proba</td>
<td>bool</td>
<td>Model predictions als labels (True) or probabilities when available (False).</td>
<td></td>
</tr>
<tr>
<td>Defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]</td>
<td>Provider, how instances were perturbed and optionally the corresponding predictions for each instance.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed
</code></pre></div>
</td></tr></table>
</details>
<h4 id="weigh_samples_1">weigh_samples</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">weigh_samples</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def weigh_samples(self, a, b=None, metric=&#39;cosine&#39;):

        if b is None:

            b = a[0]

        return self.kernel_fn(pairwise_distances(a, b, metric=metric))
</code></pre></div>
</td></tr></table>
</details>
<h3 id="localexplanation">LocalExplanation</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LocalExplanation</span><span class="p">(</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">augmenter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">LocalTokenPertubator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class LocalExplanation(Readable):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 seed: int = 0):

        &quot;&quot;&quot;Generate explanation for a single decision.

        Args:

            env (Optional[AbstractEnvironment], optional): Environment to save local perturbations in. Defaults to None.

            augmenter (Optional[LocalTokenPertubator], optional):

                Function to augment data with perturbations, to generate neighborhood data. Defaults to None.

            labelset (Optional[Union[Sequence[str], LabelProvider]], optional): Sequence of label names or

                LabelProvider containing named labels. When not supplied, it uses identifiers for labels.

                Defaults to None.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        &quot;&quot;&quot;

        super().__init__()

        self.env = default_env(env)

        if augmenter is None:

            augmenter = TokenReplacement(env=self.env, detokenizer=default_detokenizer)

        if isinstance(labelset, LabelProvider) and hasattr(labelset, &#39;labelset&#39;):

            labelset = list(labelset.labelset)

        elif labelset is None and self.env is not None:

            if hasattr(self.env.labels, &#39;labelset&#39;):

                labelset = list(self.env.labels.labelset)

        self.labelset = labelset

        self.augmenter = augmenter

        self._seed = seed

    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_4">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="descendants_1">Descendants</h4>
<ul>
<li>text_explainability.local_explanation.LIME</li>
<li>text_explainability.local_explanation.KernelSHAP</li>
<li>text_explainability.local_explanation.Anchor</li>
<li>text_explainability.local_explanation.LocalTree</li>
<li>text_explainability.local_explanation.FoilTree</li>
<li>text_explainability.local_explanation.LocalRules</li>
</ul>
<h4 id="methods_5">Methods</h4>
<h4 id="augment_sample_4">augment_sample</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">augment_sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">TextInstance</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">machinelearning</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractClassifier</span><span class="p">,</span>
    <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">add_background_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">predict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">avoid_proba</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Augment a single sample to generate neighborhood data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample</td>
<td>TextInstance</td>
<td>Instance to perturb.</td>
<td>None</td>
</tr>
<tr>
<td>model</td>
<td>AbstractClassifier</td>
<td>Model to provide predictions for neighborhood data.</td>
<td>None</td>
</tr>
<tr>
<td>sequential</td>
<td>bool</td>
<td>Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>contiguous</td>
<td>bool</td>
<td>Whether to apply perturbations on contiguous stretches of text. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>n_samples</td>
<td>int</td>
<td>Number of neighborhood samples to generate. Defaults to 50.</td>
<td>50</td>
</tr>
<tr>
<td>add_background_instance</td>
<td>bool</td>
<td>Add an additional instance with all tokens replaced. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>predict</td>
<td>bool</td>
<td>Defaults to True.</td>
<td>None</td>
</tr>
<tr>
<td>avoid_proba</td>
<td>bool</td>
<td>Model predictions als labels (True) or probabilities when available (False).</td>
<td></td>
</tr>
<tr>
<td>Defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]</td>
<td>Provider, how instances were perturbed and optionally the corresponding predictions for each instance.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed
</code></pre></div>
</td></tr></table>
</details>
<h3 id="localrules">LocalRules</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LocalRules</span><span class="p">(</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">augmenter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">LocalTokenPertubator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">local_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">surrogate</span><span class="o">.</span><span class="n">RuleSurrogate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">explanation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;multiclass&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class LocalRules(FactFoilMixin, LocalExplanation, WeightedExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 local_model: Optional[RuleSurrogate] = None,

                 kernel: Optional[Callable] = None,

                 kernel_width: Union[int, float] = 25,

                 explanation_type: str = &#39;multiclass&#39;,

                 seed: int = 0):

        LocalExplanation.__init__(self, env=env, augmenter=augmenter, labelset=labelset, seed=seed)

        WeightedExplanation.__init__(self, kernel=kernel, kernel_width=kernel_width)

        if local_model is None:

            local_model = RuleSurrogate(SkopeRules(max_depth_duplication=2,

                                                   n_estimators=30,

                                                   random_state=self._seed))

        self.local_model = local_model

        self.explanation_type = explanation_type

    @text_instance

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 foil_fn: Union[FactFoilEncoder, int, str],

                 n_samples: int = 50,

                 weigh_samples: bool = True,

                 distance_metric: str = &#39;cosine&#39;,

                 **sample_kwargs):

        provider, perturbed, y = self.augment_sample(sample,

                                                     model,

                                                     n_samples=n_samples,

                                                     avoid_proba=True,

                                                     **sample_kwargs)

        perturbed = binarize(perturbed)  # flatten all n replacements into one

        # Encode foil as 0 and rest as 1

        labelset = self.labelset if self.labelset else model

        y_ = self.to_fact_foil(y, labelset, foil_fn)

        weights = self.weigh_samples(perturbed, metric=distance_metric) if weigh_samples else None

        self.local_model.fit(perturbed, y_, weights=weights)

        return Rules(provider,

                     rules=self.local_model,

                     labelset=labelset,

                     sampled=True)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_5">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.local_explanation.FactFoilMixin</li>
<li>text_explainability.local_explanation.LocalExplanation</li>
<li>text_explainability.default.Readable</li>
<li>text_explainability.local_explanation.WeightedExplanation</li>
</ul>
<h4 id="methods_6">Methods</h4>
<h4 id="augment_sample_5">augment_sample</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">augment_sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">TextInstance</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">machinelearning</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractClassifier</span><span class="p">,</span>
    <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">add_background_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">predict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">avoid_proba</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Augment a single sample to generate neighborhood data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample</td>
<td>TextInstance</td>
<td>Instance to perturb.</td>
<td>None</td>
</tr>
<tr>
<td>model</td>
<td>AbstractClassifier</td>
<td>Model to provide predictions for neighborhood data.</td>
<td>None</td>
</tr>
<tr>
<td>sequential</td>
<td>bool</td>
<td>Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>contiguous</td>
<td>bool</td>
<td>Whether to apply perturbations on contiguous stretches of text. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>n_samples</td>
<td>int</td>
<td>Number of neighborhood samples to generate. Defaults to 50.</td>
<td>50</td>
</tr>
<tr>
<td>add_background_instance</td>
<td>bool</td>
<td>Add an additional instance with all tokens replaced. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>predict</td>
<td>bool</td>
<td>Defaults to True.</td>
<td>None</td>
</tr>
<tr>
<td>avoid_proba</td>
<td>bool</td>
<td>Model predictions als labels (True) or probabilities when available (False).</td>
<td></td>
</tr>
<tr>
<td>Defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]</td>
<td>Provider, how instances were perturbed and optionally the corresponding predictions for each instance.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed
</code></pre></div>
</td></tr></table>
</details>
<h4 id="to_fact_foil_2">to_fact_foil</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">to_fact_foil</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">y</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">,</span>
    <span class="n">foil_fn</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">target_encoding</span><span class="o">.</span><span class="n">FactFoilEncoder</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def to_fact_foil(self, y, labelset, foil_fn: Union[FactFoilEncoder, int, str]):

        if isinstance(foil_fn, str):

            foil_fn = FactFoilEncoder.from_str(foil_fn, labelset)

        elif isinstance(foil_fn, int):

            foil_fn = FactFoilEncoder(foil_fn, labelset)

        return foil_fn(y)
</code></pre></div>
</td></tr></table>
</details>
<h4 id="weigh_samples_2">weigh_samples</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">weigh_samples</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def weigh_samples(self, a, b=None, metric=&#39;cosine&#39;):

        if b is None:

            b = a[0]

        return self.kernel_fn(pairwise_distances(a, b, metric=metric))
</code></pre></div>
</td></tr></table>
</details>
<h3 id="localtree">LocalTree</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LocalTree</span><span class="p">(</span>
    <span class="n">env</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractEnvironment</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">labelset</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">augmenter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">augmentation</span><span class="o">.</span><span class="n">LocalTokenPertubator</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">local_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">text_explainability</span><span class="o">.</span><span class="n">generation</span><span class="o">.</span><span class="n">surrogate</span><span class="o">.</span><span class="n">TreeSurrogate</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span><span class="p">,</span>
    <span class="n">explanation_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;multiclass&#39;</span><span class="p">,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class LocalTree(LocalExplanation, WeightedExplanation):

    def __init__(self,

                 env: Optional[AbstractEnvironment] = None,

                 labelset: Optional[Union[Sequence[str], LabelProvider]] = None,

                 augmenter: Optional[LocalTokenPertubator] = None,

                 local_model: Optional[TreeSurrogate] = None,

                 kernel: Optional[Callable] = None,

                 kernel_width: Union[int, float] = 25,

                 explanation_type: str = &#39;multiclass&#39;,

                 seed: int = 0):

        LocalExplanation.__init__(self, env=env, augmenter=augmenter, labelset=labelset, seed=seed)

        WeightedExplanation.__init__(self, kernel=kernel, kernel_width=kernel_width)

        if local_model is None:

            local_model = TreeSurrogate(DecisionTreeClassifier(random_state=self._seed))

        self.local_model = local_model

        self.explanation_type = explanation_type

    @text_instance

    def __call__(self,

                 sample: TextInstance,

                 model: AbstractClassifier,

                 n_samples: int = 50,

                 weigh_samples: bool = True,

                 distance_metric: str = &#39;cosine&#39;,

                 max_rule_size: Optional[int] = None,

                 **sample_kwargs):

        provider, perturbed, y = self.augment_sample(sample,

                                                     model,

                                                     n_samples=n_samples,

                                                     avoid_proba=True,

                                                     **sample_kwargs)

        perturbed = binarize(perturbed)  # flatten all n replacements into one

        weights = self.weigh_samples(perturbed, metric=distance_metric) if weigh_samples else None

        self.local_model.max_rule_size = max_rule_size

        self.local_model.fit(perturbed, y, weights=weights)

        return Rules(provider=provider,

                     rules=self.local_model,

                     labelset=self.labelset,

                     sampled=True)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_6">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.local_explanation.LocalExplanation</li>
<li>text_explainability.default.Readable</li>
<li>text_explainability.local_explanation.WeightedExplanation</li>
</ul>
<h4 id="methods_7">Methods</h4>
<h4 id="augment_sample_6">augment_sample</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">augment_sample</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">sample</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">TextInstance</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">machinelearning</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractClassifier</span><span class="p">,</span>
    <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">n_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">50</span><span class="p">,</span>
    <span class="n">add_background_instance</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">predict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">avoid_proba</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">InstanceProvider</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Augment a single sample to generate neighborhood data.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>sample</td>
<td>TextInstance</td>
<td>Instance to perturb.</td>
<td>None</td>
</tr>
<tr>
<td>model</td>
<td>AbstractClassifier</td>
<td>Model to provide predictions for neighborhood data.</td>
<td>None</td>
</tr>
<tr>
<td>sequential</td>
<td>bool</td>
<td>Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>contiguous</td>
<td>bool</td>
<td>Whether to apply perturbations on contiguous stretches of text. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>n_samples</td>
<td>int</td>
<td>Number of neighborhood samples to generate. Defaults to 50.</td>
<td>50</td>
</tr>
<tr>
<td>add_background_instance</td>
<td>bool</td>
<td>Add an additional instance with all tokens replaced. Defaults to False.</td>
<td>False</td>
</tr>
<tr>
<td>predict</td>
<td>bool</td>
<td>Defaults to True.</td>
<td>None</td>
</tr>
<tr>
<td>avoid_proba</td>
<td>bool</td>
<td>Model predictions als labels (True) or probabilities when available (False).</td>
<td></td>
</tr>
<tr>
<td>Defaults to False.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]</td>
<td>Provider, how instances were perturbed and optionally the corresponding predictions for each instance.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    @text_instance(tokenize=True)

    def augment_sample(self,

                       sample: TextInstance,

                       model: AbstractClassifier,

                       sequential: bool = False,

                       contiguous: bool = False,

                       n_samples: int = 50,

                       add_background_instance: bool = False,

                       predict: bool = True,

                       avoid_proba: bool = False

                       ) -&gt; Union[Tuple[InstanceProvider, np.ndarray],

                                  Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

        &quot;&quot;&quot;Augment a single sample to generate neighborhood data.

        Args:

            sample (TextInstance): Instance to perturb.

            model (AbstractClassifier): Model to provide predictions for neighborhood data.

            sequential (bool, optional):

                Whether to sequentially sample based on length (first length 1, then 2, ...). Defaults to False.

            contiguous (bool, optional):

                Whether to apply perturbations on contiguous stretches of text. Defaults to False.

            n_samples (int, optional): Number of neighborhood samples to generate. Defaults to 50.

            add_background_instance (bool, optional):

                Add an additional instance with all tokens replaced. Defaults to False.

            predict (bool, optional):  Defaults to True.

            avoid_proba (bool, optional): Model predictions als labels (True) or probabilities when available (False).

                Defaults to False.

        Returns:

            Union[Tuple[InstanceProvider, np.ndarray], Tuple[InstanceProvider, np.ndarray, np.ndarray]]:

                Provider, how instances were perturbed and optionally the corresponding predictions for each instance.

        &quot;&quot;&quot;

        provider = self.env.create_empty_provider()

        sample.map_to_original = np.ones(len(sample.tokenized), dtype=int)

        provider.add(sample)

        # Do sampling

        augmenter = self.augmenter(sample,

                                   sequential=sequential,

                                   contiguous=contiguous,

                                   n_samples=n_samples,

                                   add_background_instance=add_background_instance)

        for perturbed_sample in augmenter.bulk_get_all():

            provider.add(perturbed_sample)

        # Perform prediction

        if predict:

            ys = model.predict_proba_raw(provider)

            y = np.vstack([y_ for id, y_ in ys]).squeeze()

            if avoid_proba:

                y = np.argmax(y, axis=1)

        # Mapping to which instances were perturbed

        perturbed = np.stack([instance.map_to_original for instance in provider.get_all()])

        if predict:

            return provider, perturbed, y

        return provider, perturbed
</code></pre></div>
</td></tr></table>
</details>
<h4 id="weigh_samples_3">weigh_samples</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">weigh_samples</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def weigh_samples(self, a, b=None, metric=&#39;cosine&#39;):

        if b is None:

            b = a[0]

        return self.kernel_fn(pairwise_distances(a, b, metric=metric))
</code></pre></div>
</td></tr></table>
</details>
<h3 id="weightedexplanation">WeightedExplanation</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">WeightedExplanation</span><span class="p">(</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kernel_width</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">25</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class WeightedExplanation:

    def __init__(self, kernel: Optional[Callable] = None, kernel_width: Union[int, float] = 25):

        &quot;&quot;&quot;Add weights to neighborhood data.

        Args:

            kernel (Optional[Callable], optional):  Kernel to determine similarity of perturbed instances to original

                instance (if set to None defaults to `data.weights.exponential_kernel`). Defaults to None.

            kernel_width (Union[int, float], optional): Hyperparameter for similarity function of kernel.

                Defaults to 25.

        &quot;&quot;&quot;

        if kernel is None:

            kernel = exponential_kernel

        self.kernel_fn = lambda d: kernel(d, kernel_width)

    def weigh_samples(self, a, b=None, metric=&#39;cosine&#39;):

        if b is None:

            b = a[0]

        return self.kernel_fn(pairwise_distances(a, b, metric=metric))
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="descendants_2">Descendants</h4>
<ul>
<li>text_explainability.local_explanation.LIME</li>
<li>text_explainability.local_explanation.LocalTree</li>
<li>text_explainability.local_explanation.FoilTree</li>
<li>text_explainability.local_explanation.LocalRules</li>
</ul>
<h4 id="methods_8">Methods</h4>
<h4 id="weigh_samples_4">weigh_samples</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">weigh_samples</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">a</span><span class="p">,</span>
    <span class="n">b</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;cosine&#39;</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def weigh_samples(self, a, b=None, metric=&#39;cosine&#39;):

        if b is None:

            b = a[0]

        return self.kernel_fn(pairwise_distances(a, b, metric=metric))
</code></pre></div>
</td></tr></table>
</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../internationalization/" title="Internationalization" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Internationalization
              </span>
            </div>
          </a>
        
        
          <a href="../locale/" title="Locale" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Locale
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://github.com/MarcelRobeer/Text_Explainability" target="_blank" rel="noopener" title="text_explainability on GitHub" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.53c85856.min.js", "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.716f8af4.min.js"></script>
      
    
  </body>
</html>