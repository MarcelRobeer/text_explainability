
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.0">
    
    
      
        <title>Sampling - text_explainability</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.fe914879.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.ba0d045b.min.css">
        
          
          
          <meta name="theme-color" content="#546d78">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue-grey" data-md-color-accent="#80d8ff">
  
    
    <script>function __prefix(e){return new URL("../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-text_explainabilitydatasampling" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="text_explainability" class="md-header__button md-logo" aria-label="text_explainability" data-md-component="logo">
      
  <img src="https://i.ibb.co/pvkkWqZ/Text-Logo-Logo-white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            text_explainability
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Sampling
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://git.science.uu.nl/m.j.robeer/text_explainability.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    text_explainability
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="text_explainability" class="md-nav__button md-logo" aria-label="text_explainability" data-md-component="logo">
      
  <img src="https://i.ibb.co/pvkkWqZ/Text-Logo-Logo-white.png" alt="logo">

    </a>
    text_explainability
  </label>
  
    <div class="md-nav__source">
      
<a href="https://git.science.uu.nl/m.j.robeer/text_explainability.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    text_explainability
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../docs/installation/" class="md-nav__link">
        Installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../example_usage/" class="md-nav__link">
        Example usage
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../CHANGELOG/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      <label class="md-nav__link" for="__nav_5">
        Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1" type="checkbox" id="__nav_5_1" checked>
      
      <label class="md-nav__link" for="__nav_5_1">
        Text Explainability
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Text Explainability" data-md-level="2">
        <label class="md-nav__title" for="__nav_5_1">
          <span class="md-nav__icon md-icon"></span>
          Text Explainability
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../decorators/" class="md-nav__link">
        Decorators
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../default/" class="md-nav__link">
        Default
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../global_explanation/" class="md-nav__link">
        Global Explanation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../internationalization/" class="md-nav__link">
        Internationalization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../local_explanation/" class="md-nav__link">
        Local Explanation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../locale/" class="md-nav__link">
        Locale
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/" class="md-nav__link">
        Utils
      </a>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_9" type="checkbox" id="__nav_5_1_9" checked>
      
      <label class="md-nav__link" for="__nav_5_1_9">
        Data
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Data" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_9">
          <span class="md-nav__icon md-icon"></span>
          Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../augmentation/" class="md-nav__link">
        Augmentation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../embedding/" class="md-nav__link">
        Embedding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Sampling
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Sampling
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kmedoids" class="md-nav__link">
    KMedoids
  </a>
  
    <nav class="md-nav" aria-label="KMedoids">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labelwisekmedoids" class="md-nav__link">
    LabelwiseKMedoids
  </a>
  
    <nav class="md-nav" aria-label="LabelwiseKMedoids">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_1" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labelwisemmdcritic" class="md-nav__link">
    LabelwiseMMDCritic
  </a>
  
    <nav class="md-nav" aria-label="LabelwiseMMDCritic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticisms" class="md-nav__link">
    criticisms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_2" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labelwiseprototypesampler" class="md-nav__link">
    LabelwisePrototypeSampler
  </a>
  
    <nav class="md-nav" aria-label="LabelwisePrototypeSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_3" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_3" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_3" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mmdcritic" class="md-nav__link">
    MMDCritic
  </a>
  
    <nav class="md-nav" aria-label="MMDCritic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_4" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_1" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_4" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticisms_1" class="md-nav__link">
    criticisms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_4" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypesampler" class="md-nav__link">
    PrototypeSampler
  </a>
  
    <nav class="md-nav" aria-label="PrototypeSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_5" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants_1" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_2" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_5" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_5" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../weights/" class="md-nav__link">
        Weights
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5_1_10" type="checkbox" id="__nav_5_1_10" >
      
      <label class="md-nav__link" for="__nav_5_1_10">
        Generation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Generation" data-md-level="3">
        <label class="md-nav__title" for="__nav_5_1_10">
          <span class="md-nav__icon md-icon"></span>
          Generation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generation/feature_selection/" class="md-nav__link">
        Feature Selection
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generation/" class="md-nav__link">
        Index
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generation/return_types/" class="md-nav__link">
        Return Types
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generation/surrogate/" class="md-nav__link">
        Surrogate
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../generation/target_encoding/" class="md-nav__link">
        Target Encoding
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#kmedoids" class="md-nav__link">
    KMedoids
  </a>
  
    <nav class="md-nav" aria-label="KMedoids">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labelwisekmedoids" class="md-nav__link">
    LabelwiseKMedoids
  </a>
  
    <nav class="md-nav" aria-label="LabelwiseKMedoids">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_1" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_1" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_1" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labelwisemmdcritic" class="md-nav__link">
    LabelwiseMMDCritic
  </a>
  
    <nav class="md-nav" aria-label="LabelwiseMMDCritic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_2" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_2" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticisms" class="md-nav__link">
    criticisms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_2" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#labelwiseprototypesampler" class="md-nav__link">
    LabelwisePrototypeSampler
  </a>
  
    <nav class="md-nav" aria-label="LabelwisePrototypeSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_3" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_3" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_3" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mmdcritic" class="md-nav__link">
    MMDCritic
  </a>
  
    <nav class="md-nav" aria-label="MMDCritic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_4" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_1" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_4" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#criticisms_1" class="md-nav__link">
    criticisms
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_4" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypesampler" class="md-nav__link">
    PrototypeSampler
  </a>
  
    <nav class="md-nav" aria-label="PrototypeSampler">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ancestors-in-mro_5" class="md-nav__link">
    Ancestors (in MRO)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#descendants_1" class="md-nav__link">
    Descendants
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#instance-variables_2" class="md-nav__link">
    Instance variables
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#methods_5" class="md-nav__link">
    Methods
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prototypes_5" class="md-nav__link">
    prototypes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="module-text_explainabilitydatasampling">Module text_explainability.data.sampling</h1>
<p>Sample an (informative) subset from the data.</p>
<p>Todo:
    * Sample (informative?) subset from data
    * Refactor to make sampling base class
    * Add ability to perform MMD critic on a subset (e.g. single class)</p>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>&quot;&quot;&quot;Sample an (informative) subset from the data.

Todo:

    * Sample (informative?) subset from data

    * Refactor to make sampling base class

    * Add ability to perform MMD critic on a subset (e.g. single class)

&quot;&quot;&quot;

from typing import Dict, Sequence, Callable, Optional, Union

import numpy as np

from instancelib.instances.memory import MemoryBucketProvider

from instancelib.instances.text import MemoryTextInstance

from instancelib.labels.memory import MemoryLabelProvider

from instancelib.labels.base import LabelProvider

from instancelib.machinelearning.base import AbstractClassifier

from text_explainability.data.embedding import Embedder, TfidfVectorizer

from text_explainability.data.weights import exponential_kernel

from text_explainability.default import Readable

class PrototypeSampler(Readable):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 embedder: Embedder = TfidfVectorizer):

        &quot;&quot;&quot;Generic class for sampling prototypes (representative samples) based on embedding distances.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

        &quot;&quot;&quot;

        self.embedder = embedder() if isinstance(embedder, type) else embedder

        self.instances = self.embedder(instances) if any(instances[i].vector is None for i in instances) \

                         else instances

    @property

    def embedded(self) -&gt; np.ndarray:

        return np.stack(self.instances.bulk_get_vectors(list(self.instances))[-1])

    def _select_from_provider(self, keys: Sequence[int]) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select instances from provider by keys.&quot;&quot;&quot;

        return [self.instances[i] for i in keys]

    def prototypes(self, n: int = 5) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        &quot;&quot;&quot;

        raise NotImplementedError(&#39;Implemented in subclasses&#39;)

    def __call__(self, *args, **kwargs):

        return self.prototypes(*args, **kwargs)

class KMedoids(PrototypeSampler):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 embedder: Embedder = TfidfVectorizer,

                 seed: int = 0):

        &quot;&quot;&quot;Sampling prototypes (representative samples) based on embedding distances using `k-Medoids`_.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        .. _k-Medoids:

            https://scikit-learn-extra.readthedocs.io/en/stable/generated/sklearn_extra.cluster.KMedoids.html

        &quot;&quot;&quot;

        super().__init__(instances, embedder)

        self._seed = seed

    def prototypes(self,

                   n: int = 5,

                   metric: Union[str, Callable] = &#39;cosine&#39;,

                   **kwargs) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes (most representative samples) using `k-Medoids`_.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

            metrics (Union[str, Callable], optional): Distance metric used to calculate medoids (e.g. &#39;cosine&#39;,

                &#39;euclidean&#39; or your own function). See `pairwise distances` for a full list. Defaults to &#39;cosine&#39;.

            **kwargs: Optional arguments passed to `k-Medoids`_ constructor.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        .. _k-Medoids:

            https://scikit-learn-extra.readthedocs.io/en/stable/generated/sklearn_extra.cluster.KMedoids.html

        .. _pairwise distances:

            https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise_distances.html

        &quot;&quot;&quot;

        from sklearn_extra.cluster import KMedoids

        kmedoids = KMedoids(n_clusters=n, metric=metric, random_state=self._seed, **kwargs).fit(self.embedded)

        return self._select_from_provider(kmedoids.medoid_indices_)

class MMDCritic(PrototypeSampler):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 embedder: Embedder = TfidfVectorizer,

                 kernel: Callable = exponential_kernel):

        &quot;&quot;&quot;Select prototypes and criticisms based on embedding distances using `MMD-Critic`_.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            kernel (Callable, optional): Kernel to calculate distances. Defaults to exponential_kernel.

        .. _MMD-critic:

            https://christophm.github.io/interpretable-ml-book/proto.html

        &quot;&quot;&quot;

        super().__init__(instances, embedder)

        self.kernel = kernel

        self._calculate_kernel()

        self._prototypes = None

        self._criticisms = None

    def _calculate_kernel(self):

        &quot;&quot;&quot;Calculate kernel `K` and column totals `colsum`.&quot;&quot;&quot;

        self.K = self.kernel(self.embedded, 1.0 / self.embedded.shape[1])

        self.colsum = np.sum(self.K, axis=0) / self.embedded.shape[1]

    def prototypes(self, n: int = 5) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes (most representatitve instances), using `MMD-critic implementation`_.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        .. _MMD-critic implementation:

            https://github.com/maxidl/MMD-critic/blob/main/mmd_critic.py

        &quot;&quot;&quot;

        assert n &lt;= len(self.instances), f&#39;Cannot select more than all instances ({len(self.instances)}.&#39;

        K = self.K

        colsum = self.colsum.copy() * 2

        sample_indices = np.array(list(self.instances))

        is_selected = np.zeros_like(sample_indices)

        selected = sample_indices[is_selected &gt; 0]

        for i in range(n):

            candidate_indices = sample_indices[is_selected == 0]

            s1 = colsum[candidate_indices]

            diag = np.diagonal(K)[candidate_indices]

            if selected.shape[0] == 0:

                s1 -= np.abs(diag)

            else:

                temp = K[selected, :][:, candidate_indices]

                s2 = np.sum(temp, axis=0) * 2 + diag

                s2 /= (selected.shape[0] + 1)

                s1 -= s2

            best_sample_index = candidate_indices[np.argmax(s1)]

            is_selected[best_sample_index] = i + 1

            selected = sample_indices[is_selected &gt; 0]

        selected_in_order = selected[is_selected[is_selected &gt; 0].argsort()]

        self._prototypes = self._select_from_provider(selected_in_order)

        return self._prototypes

    def criticisms(self, n: int = 5, regularizer: Optional[str] = None) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` criticisms (instances not well represented by prototypes), using `MMD-critic implementation`_.

        Args:

            n (int, optional): Number of criticisms to select. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Raises:

            Exception: `MMDCritic.prototypes()` must first be run before being able to determine the criticisms.

        Returns:

            Sequence[MemoryTextInstance]: List of criticism instances.

        .. _MMD-critic implementation:

            https://github.com/maxidl/MMD-critic/blob/main/mmd_critic.py

        &quot;&quot;&quot;

        if self._prototypes is None:

            raise Exception(&#39;Calculating criticisms requires prototypes. Run `MMDCritic.prototypes()` first.&#39;)

        regularizers = {None, &#39;logdet&#39;, &#39;iterative&#39;}

        assert regularizer in regularizers, \

            f&#39;Unknown regularizer &quot;{regularizer}&quot;, choose from {regularizers}.&#39;

        assert n &lt;= (len(self.instances) - len(self._prototypes)), \

            f&#39;Cannot select more than instances excluding prototypes ({len(self.instances) - len(self._prototypes)})&#39;

        prototypes = np.array([p.identifier for p in self._prototypes])

        K = self.K

        colsum = self.colsum

        sample_indices = np.arange(0, len(self.instances))

        is_selected = np.zeros_like(sample_indices)

        selected = sample_indices[is_selected &gt; 0]

        is_selected[prototypes] = n + 1

        inverse_of_prev_selected = None

        for i in range(n):

            candidate_indices = sample_indices[is_selected == 0]

            s1 = colsum[candidate_indices]

            temp = K[prototypes, :][:, candidate_indices]

            s2 = np.sum(temp, axis=0)

            s2 /= prototypes.shape[0]

            s1 -= s2

            s1 = np.abs(s1)

            if regularizer == &#39;logdet&#39;:

                diag = np.diagonal(K)[candidate_indices]

                if inverse_of_prev_selected is not None:

                    temp = K[selected, :][:, candidate_indices]

                    temp2 = np.dot(inverse_of_prev_selected, temp)

                    reg = temp2 * temp

                    regcolsum = np.sum(reg, axis=0)

                    with np.errstate(divide=&#39;ignore&#39;):

                        reg = np.log(np.abs(diag - regcolsum))

                    s1 += reg

                else:

                    with np.errstate(divide=&#39;ignore&#39;):

                        s1 -= np.log(np.abs(diag))

            best_sample_index = candidate_indices[np.argmax(s1)]

            is_selected[best_sample_index] = i + 1

            selected = sample_indices[(is_selected &gt; 0) &amp; (is_selected != (n + 1))]

            if regularizer == &#39;iterative&#39;:

                prototypes = np.concatenate([prototypes, np.expand_dims(best_sample_index, 0)])

            if regularizer == &#39;logdet&#39;:

                inverse_of_prev_selected = np.linalg.pinv(K[selected, :][:, selected])

        selected_in_order = selected[is_selected[(is_selected &gt; 0) &amp; (is_selected != (n + 1))].argsort()]

        self._criticisms = self._select_from_provider(selected_in_order)

        return self._criticisms

    def __call__(self,

                 n_prototypes: int = 5,

                 n_criticisms: int = 5,

                 regularizer: Optional[str] = None) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Calculate prototypes and criticisms for the provided instances.

        Args:

            n_prototypes (int, optional): Number of prototypes. Defaults to 5.

            n_criticisms (int, optional): Number of criticisms. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary containing prototypes and criticisms.

        &quot;&quot;&quot;

        return {&#39;prototypes&#39;: self.prototypes(n=n_prototypes),

                &#39;criticisms&#39;: self.criticisms(n=n_criticisms, regularizer=regularizer)}

class LabelwisePrototypeSampler(Readable):

    def __init__(self,

                 sampler: PrototypeSampler,

                 instances: MemoryBucketProvider,

                 labels: Union[Sequence[str], Sequence[int], LabelProvider, AbstractClassifier],

                 embedder: Embedder = TfidfVectorizer,

                 **kwargs):

        &quot;&quot;&quot;Apply `PrototypeSampler()` for each label.

        Args:

            sampler (PrototypeSampler): Prototype sampler to construct (e.g. `KMedoids`, `MMDCritic`)

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            labels (Union[Sequence[str], Sequence[int], LabelProvider, AbstractClassifier]): Ground-truth or predicted

                labels, providing the groups (e.g. classes) in which to subdivide the instances.

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            **kwargs: Additional arguments passed to `_setup_instances()` constructor.

        &quot;&quot;&quot;

        self.sampler = sampler if isinstance(sampler, type) else self.sampler.__class__

        self.instances = instances

        self._get_labels(labels)

        self._setup_samplers(embedder, **kwargs)

    def _get_labels(self,

                    labels: Union[Sequence[str], Sequence[int], LabelProvider, AbstractClassifier]):

        &quot;&quot;&quot;Transform the labels into a `LabelProvider`.&quot;&quot;&quot;

        if not isinstance(labels, LabelProvider):

            if isinstance(labels, AbstractClassifier):

                labels_ = labels.predict(self.instances)

            else:

                labels_ = [(id, frozenset({label})) for id, label in zip(list(self.instances), labels)]

            labels = MemoryLabelProvider.from_tuples(labels_)

        self.labels = labels

    def _setup_samplers(self,

                        embedder: Embedder,

                        **kwargs):

        &quot;&quot;&quot;Setup a sampler for each label in `self.labels.labelset`.

        Args:

            embedder (Embedder): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            **kwargs: Additional arguments passed to sampler constructor.

        &quot;&quot;&quot;

        import copy

        def select_by_label(label):

            instances = copy.deepcopy(self.instances)

            keys_to_keep = self.labels.get_instances_by_label(label)

            instances._remove_from_bucket(frozenset(list(instances)).difference(keys_to_keep))

            return instances

        self._samplers = {label: self.sampler(instances=select_by_label(label),

                                              embedder=embedder,

                                              **kwargs)

                          for label in self.labels.labelset}

        self.samplers = self._samplers

    def prototypes(self, n: int = 5) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Select `n` prototypes (most representatitve instances).

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary with labels and corresponding list of prototypes.

        &quot;&quot;&quot;

        return {label: sampler.prototypes(n=n)

                for label, sampler in self._samplers.items()}

    def __call__(self,

                 n: int = 5) -&gt; Dict[str, Dict[str, Sequence[MemoryTextInstance]]]:

        &quot;&quot;&quot;Generate prototypes for each label.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Dict[str, Dict[str, Sequence[MemoryTextInstance]]]: Dictionary with labels and corresponding dictionary

                containing prototypes.

        &quot;&quot;&quot;

        return {label: {&#39;prototypes&#39;: sampler.prototypes(n=n)}

                for label, sampler in self._samplers.items()}

class LabelwiseKMedoids(LabelwisePrototypeSampler):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 labels: Union[Sequence[str], Sequence[int], LabelProvider],

                 embedder: Embedder = TfidfVectorizer,

                 seed: int = 0):

        &quot;&quot;&quot;Select prototypes for each label based on embedding distances using `k-Medoids`_.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            labels (Union[Sequence[str], Sequence[int], LabelProvider]): Ground-truth or predicted labels, providing

                the groups (e.g. classes) in which to subdivide the instances.

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        .. _k-Medoids:

            https://scikit-learn-extra.readthedocs.io/en/stable/generated/sklearn_extra.cluster.KMedoids.html

        &quot;&quot;&quot;

        super().__init__(KMedoids,

                         instances=instances,

                         labels=labels,

                         embedder=embedder,

                         seed=seed)

class LabelwiseMMDCritic(LabelwisePrototypeSampler):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 labels: Union[Sequence[str], Sequence[int], LabelProvider],

                 embedder: Embedder = TfidfVectorizer,

                 kernel: Callable = exponential_kernel):

        &quot;&quot;&quot;Select prototypes and criticisms for each label based on embedding distances using `MMD-Critic`_.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            labels (Union[Sequence[str], Sequence[int], LabelProvider]): Ground-truth or predicted labels, providing

                the groups (e.g. classes) in which to subdivide the instances.

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            kernel (Callable, optional): Kernel to calculate distances. Defaults to exponential_kernel.

        .. _MMD-critic:

            https://christophm.github.io/interpretable-ml-book/proto.html

        &quot;&quot;&quot;

        super().__init__(MMDCritic,

                         instances=instances,

                         labels=labels,

                         embedder=embedder,

                         kernel=kernel)

    def criticisms(self, n: int = 5, regularizer: Optional[str] = None) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Select `n` criticisms (instances not well represented by prototypes).

        Args:

            n (int, optional): Number of criticisms to select. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Raises:

            Exception: `MMDCritic.prototypes()` must first be run before being able to determine the criticisms.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary with labels and corresponding list of criticisms.

        &quot;&quot;&quot;

        return {label: sampler.criticisms(n=n, regularizer=regularizer)

                for label, sampler in self._samplers.items()}

    def __call__(self,

                 n_prototypes: int = 5,

                 n_criticisms: int = 5,

                 regularizer: Optional[str] = None) -&gt; Dict[str, Dict[str, Sequence[MemoryTextInstance]]]:

        &quot;&quot;&quot;Generate prototypes and criticisms for each label.

        Args:

            n_prototypes (int, optional): Number of prototypes to select. Defaults to 5.

            n_criticisms (int, optional): Number of criticisms to select. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Returns:

            Dict[str, Dict[str, Sequence[MemoryTextInstance]]]: Dictionary with labels and corresponding dictionary

                containing prototypes and criticisms.

        &quot;&quot;&quot;

        return {label: sampler(n_prototypes=n_prototypes, n_criticisms=n_criticisms, regularizer=regularizer)

                for label, sampler in self._samplers.items()}
</code></pre></div>
</td></tr></table>
</details>
<h2 id="classes">Classes</h2>
<h3 id="kmedoids">KMedoids</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">KMedoids</span><span class="p">(</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">MemoryBucketProvider</span><span class="p">,</span>
    <span class="n">embedder</span><span class="p">:</span> <span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">Embedder</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">TfidfVectorizer</span><span class="s1">&#39;&gt;,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class KMedoids(PrototypeSampler):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 embedder: Embedder = TfidfVectorizer,

                 seed: int = 0):

        &quot;&quot;&quot;Sampling prototypes (representative samples) based on embedding distances using `k-Medoids`_.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        .. _k-Medoids:

            https://scikit-learn-extra.readthedocs.io/en/stable/generated/sklearn_extra.cluster.KMedoids.html

        &quot;&quot;&quot;

        super().__init__(instances, embedder)

        self._seed = seed

    def prototypes(self,

                   n: int = 5,

                   metric: Union[str, Callable] = &#39;cosine&#39;,

                   **kwargs) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes (most representative samples) using `k-Medoids`_.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

            metrics (Union[str, Callable], optional): Distance metric used to calculate medoids (e.g. &#39;cosine&#39;,

                &#39;euclidean&#39; or your own function). See `pairwise distances` for a full list. Defaults to &#39;cosine&#39;.

            **kwargs: Optional arguments passed to `k-Medoids`_ constructor.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        .. _k-Medoids:

            https://scikit-learn-extra.readthedocs.io/en/stable/generated/sklearn_extra.cluster.KMedoids.html

        .. _pairwise distances:

            https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise_distances.html

        &quot;&quot;&quot;

        from sklearn_extra.cluster import KMedoids

        kmedoids = KMedoids(n_clusters=n, metric=metric, random_state=self._seed, **kwargs).fit(self.embedded)

        return self._select_from_provider(kmedoids.medoid_indices_)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.data.sampling.PrototypeSampler</li>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="instance-variables">Instance variables</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">embedded</span>
</code></pre></div>
</td></tr></table>
<h4 id="methods">Methods</h4>
<h4 id="prototypes">prototypes</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prototypes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">metric</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Callable</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MemoryTextInstance</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<p>Select <code>n</code> prototypes (most representative samples) using <code>k-Medoids</code>_.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>int</td>
<td>Number of prototypes to select. Defaults to 5.</td>
<td>5</td>
</tr>
<tr>
<td>metrics</td>
<td>Union[str, Callable]</td>
<td>Distance metric used to calculate medoids (e.g. 'cosine',</td>
<td></td>
</tr>
<tr>
<td>'euclidean' or your own function). See <code>pairwise distances</code> for a full list. Defaults to 'cosine'.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
<tr>
<td>**kwargs</td>
<td>None</td>
<td>Optional arguments passed to <code>k-Medoids</code>_ constructor.</td>
<td>None</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sequence[MemoryTextInstance]</td>
<td>List of prototype instances.</td>
</tr>
<tr>
<td>.. _k-Medoids:</td>
<td></td>
</tr>
<tr>
<td>https://scikit-learn-extra.readthedocs.io/en/stable/generated/sklearn_extra.cluster.KMedoids.html</td>
<td></td>
</tr>
<tr>
<td>.. _pairwise distances:</td>
<td></td>
</tr>
<tr>
<td>https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise_distances.html</td>
<td></td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def prototypes(self,

                   n: int = 5,

                   metric: Union[str, Callable] = &#39;cosine&#39;,

                   **kwargs) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes (most representative samples) using `k-Medoids`_.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

            metrics (Union[str, Callable], optional): Distance metric used to calculate medoids (e.g. &#39;cosine&#39;,

                &#39;euclidean&#39; or your own function). See `pairwise distances` for a full list. Defaults to &#39;cosine&#39;.

            **kwargs: Optional arguments passed to `k-Medoids`_ constructor.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        .. _k-Medoids:

            https://scikit-learn-extra.readthedocs.io/en/stable/generated/sklearn_extra.cluster.KMedoids.html

        .. _pairwise distances:

            https://scikit-learn.org/stable/modules/generated/sklearn.metrics.pairwise_distances.html

        &quot;&quot;&quot;

        from sklearn_extra.cluster import KMedoids

        kmedoids = KMedoids(n_clusters=n, metric=metric, random_state=self._seed, **kwargs).fit(self.embedded)

        return self._select_from_provider(kmedoids.medoid_indices_)
</code></pre></div>
</td></tr></table>
</details>
<h3 id="labelwisekmedoids">LabelwiseKMedoids</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LabelwiseKMedoids</span><span class="p">(</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">MemoryBucketProvider</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">],</span>
    <span class="n">embedder</span><span class="p">:</span> <span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">Embedder</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">TfidfVectorizer</span><span class="s1">&#39;&gt;,</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class LabelwiseKMedoids(LabelwisePrototypeSampler):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 labels: Union[Sequence[str], Sequence[int], LabelProvider],

                 embedder: Embedder = TfidfVectorizer,

                 seed: int = 0):

        &quot;&quot;&quot;Select prototypes for each label based on embedding distances using `k-Medoids`_.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            labels (Union[Sequence[str], Sequence[int], LabelProvider]): Ground-truth or predicted labels, providing

                the groups (e.g. classes) in which to subdivide the instances.

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            seed (int, optional): Seed for reproducibility. Defaults to 0.

        .. _k-Medoids:

            https://scikit-learn-extra.readthedocs.io/en/stable/generated/sklearn_extra.cluster.KMedoids.html

        &quot;&quot;&quot;

        super().__init__(KMedoids,

                         instances=instances,

                         labels=labels,

                         embedder=embedder,

                         seed=seed)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_1">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.data.sampling.LabelwisePrototypeSampler</li>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="methods_1">Methods</h4>
<h4 id="prototypes_1">prototypes</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prototypes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MemoryTextInstance</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Select <code>n</code> prototypes (most representatitve instances).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>int</td>
<td>Number of prototypes to select. Defaults to 5.</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dict[str, Sequence[MemoryTextInstance]]</td>
<td>Dictionary with labels and corresponding list of prototypes.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def prototypes(self, n: int = 5) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Select `n` prototypes (most representatitve instances).

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary with labels and corresponding list of prototypes.

        &quot;&quot;&quot;

        return {label: sampler.prototypes(n=n)

                for label, sampler in self._samplers.items()}
</code></pre></div>
</td></tr></table>
</details>
<h3 id="labelwisemmdcritic">LabelwiseMMDCritic</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LabelwiseMMDCritic</span><span class="p">(</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">MemoryBucketProvider</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">],</span>
    <span class="n">embedder</span><span class="p">:</span> <span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">Embedder</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">TfidfVectorizer</span><span class="s1">&#39;&gt;,</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">exponential_kernel</span> <span class="n">at</span> <span class="mh">0x16ddf9a60</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class LabelwiseMMDCritic(LabelwisePrototypeSampler):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 labels: Union[Sequence[str], Sequence[int], LabelProvider],

                 embedder: Embedder = TfidfVectorizer,

                 kernel: Callable = exponential_kernel):

        &quot;&quot;&quot;Select prototypes and criticisms for each label based on embedding distances using `MMD-Critic`_.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            labels (Union[Sequence[str], Sequence[int], LabelProvider]): Ground-truth or predicted labels, providing

                the groups (e.g. classes) in which to subdivide the instances.

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            kernel (Callable, optional): Kernel to calculate distances. Defaults to exponential_kernel.

        .. _MMD-critic:

            https://christophm.github.io/interpretable-ml-book/proto.html

        &quot;&quot;&quot;

        super().__init__(MMDCritic,

                         instances=instances,

                         labels=labels,

                         embedder=embedder,

                         kernel=kernel)

    def criticisms(self, n: int = 5, regularizer: Optional[str] = None) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Select `n` criticisms (instances not well represented by prototypes).

        Args:

            n (int, optional): Number of criticisms to select. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Raises:

            Exception: `MMDCritic.prototypes()` must first be run before being able to determine the criticisms.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary with labels and corresponding list of criticisms.

        &quot;&quot;&quot;

        return {label: sampler.criticisms(n=n, regularizer=regularizer)

                for label, sampler in self._samplers.items()}

    def __call__(self,

                 n_prototypes: int = 5,

                 n_criticisms: int = 5,

                 regularizer: Optional[str] = None) -&gt; Dict[str, Dict[str, Sequence[MemoryTextInstance]]]:

        &quot;&quot;&quot;Generate prototypes and criticisms for each label.

        Args:

            n_prototypes (int, optional): Number of prototypes to select. Defaults to 5.

            n_criticisms (int, optional): Number of criticisms to select. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Returns:

            Dict[str, Dict[str, Sequence[MemoryTextInstance]]]: Dictionary with labels and corresponding dictionary

                containing prototypes and criticisms.

        &quot;&quot;&quot;

        return {label: sampler(n_prototypes=n_prototypes, n_criticisms=n_criticisms, regularizer=regularizer)

                for label, sampler in self._samplers.items()}
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_2">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.data.sampling.LabelwisePrototypeSampler</li>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="methods_2">Methods</h4>
<h4 id="criticisms">criticisms</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">criticisms</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">regularizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MemoryTextInstance</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Select <code>n</code> criticisms (instances not well represented by prototypes).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>int</td>
<td>Number of criticisms to select. Defaults to 5.</td>
<td>5</td>
</tr>
<tr>
<td>regularizer</td>
<td>Optional[str]</td>
<td>Regularization method. Choose from [None, 'logdet', 'iterative'].</td>
<td></td>
</tr>
<tr>
<td>Defaults to None.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dict[str, Sequence[MemoryTextInstance]]</td>
<td>Dictionary with labels and corresponding list of criticisms.</td>
</tr>
</tbody>
</table>
<p><strong>Raises:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Exception</td>
<td><code>MMDCritic.prototypes()</code> must first be run before being able to determine the criticisms.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def criticisms(self, n: int = 5, regularizer: Optional[str] = None) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Select `n` criticisms (instances not well represented by prototypes).

        Args:

            n (int, optional): Number of criticisms to select. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Raises:

            Exception: `MMDCritic.prototypes()` must first be run before being able to determine the criticisms.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary with labels and corresponding list of criticisms.

        &quot;&quot;&quot;

        return {label: sampler.criticisms(n=n, regularizer=regularizer)

                for label, sampler in self._samplers.items()}
</code></pre></div>
</td></tr></table>
</details>
<h4 id="prototypes_2">prototypes</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prototypes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MemoryTextInstance</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Select <code>n</code> prototypes (most representatitve instances).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>int</td>
<td>Number of prototypes to select. Defaults to 5.</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dict[str, Sequence[MemoryTextInstance]]</td>
<td>Dictionary with labels and corresponding list of prototypes.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def prototypes(self, n: int = 5) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Select `n` prototypes (most representatitve instances).

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary with labels and corresponding list of prototypes.

        &quot;&quot;&quot;

        return {label: sampler.prototypes(n=n)

                for label, sampler in self._samplers.items()}
</code></pre></div>
</td></tr></table>
</details>
<h3 id="labelwiseprototypesampler">LabelwisePrototypeSampler</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LabelwisePrototypeSampler</span><span class="p">(</span>
    <span class="n">sampler</span><span class="p">:</span> <span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">sampling</span><span class="o">.</span><span class="n">PrototypeSampler</span><span class="p">,</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">MemoryBucketProvider</span><span class="p">,</span>
    <span class="n">labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">LabelProvider</span><span class="p">,</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">machinelearning</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">AbstractClassifier</span><span class="p">],</span>
    <span class="n">embedder</span><span class="p">:</span> <span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">Embedder</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">TfidfVectorizer</span><span class="s1">&#39;&gt;,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class LabelwisePrototypeSampler(Readable):

    def __init__(self,

                 sampler: PrototypeSampler,

                 instances: MemoryBucketProvider,

                 labels: Union[Sequence[str], Sequence[int], LabelProvider, AbstractClassifier],

                 embedder: Embedder = TfidfVectorizer,

                 **kwargs):

        &quot;&quot;&quot;Apply `PrototypeSampler()` for each label.

        Args:

            sampler (PrototypeSampler): Prototype sampler to construct (e.g. `KMedoids`, `MMDCritic`)

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            labels (Union[Sequence[str], Sequence[int], LabelProvider, AbstractClassifier]): Ground-truth or predicted

                labels, providing the groups (e.g. classes) in which to subdivide the instances.

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            **kwargs: Additional arguments passed to `_setup_instances()` constructor.

        &quot;&quot;&quot;

        self.sampler = sampler if isinstance(sampler, type) else self.sampler.__class__

        self.instances = instances

        self._get_labels(labels)

        self._setup_samplers(embedder, **kwargs)

    def _get_labels(self,

                    labels: Union[Sequence[str], Sequence[int], LabelProvider, AbstractClassifier]):

        &quot;&quot;&quot;Transform the labels into a `LabelProvider`.&quot;&quot;&quot;

        if not isinstance(labels, LabelProvider):

            if isinstance(labels, AbstractClassifier):

                labels_ = labels.predict(self.instances)

            else:

                labels_ = [(id, frozenset({label})) for id, label in zip(list(self.instances), labels)]

            labels = MemoryLabelProvider.from_tuples(labels_)

        self.labels = labels

    def _setup_samplers(self,

                        embedder: Embedder,

                        **kwargs):

        &quot;&quot;&quot;Setup a sampler for each label in `self.labels.labelset`.

        Args:

            embedder (Embedder): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            **kwargs: Additional arguments passed to sampler constructor.

        &quot;&quot;&quot;

        import copy

        def select_by_label(label):

            instances = copy.deepcopy(self.instances)

            keys_to_keep = self.labels.get_instances_by_label(label)

            instances._remove_from_bucket(frozenset(list(instances)).difference(keys_to_keep))

            return instances

        self._samplers = {label: self.sampler(instances=select_by_label(label),

                                              embedder=embedder,

                                              **kwargs)

                          for label in self.labels.labelset}

        self.samplers = self._samplers

    def prototypes(self, n: int = 5) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Select `n` prototypes (most representatitve instances).

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary with labels and corresponding list of prototypes.

        &quot;&quot;&quot;

        return {label: sampler.prototypes(n=n)

                for label, sampler in self._samplers.items()}

    def __call__(self,

                 n: int = 5) -&gt; Dict[str, Dict[str, Sequence[MemoryTextInstance]]]:

        &quot;&quot;&quot;Generate prototypes for each label.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Dict[str, Dict[str, Sequence[MemoryTextInstance]]]: Dictionary with labels and corresponding dictionary

                containing prototypes.

        &quot;&quot;&quot;

        return {label: {&#39;prototypes&#39;: sampler.prototypes(n=n)}

                for label, sampler in self._samplers.items()}
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_3">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="descendants">Descendants</h4>
<ul>
<li>text_explainability.data.sampling.LabelwiseKMedoids</li>
<li>text_explainability.data.sampling.LabelwiseMMDCritic</li>
</ul>
<h4 id="methods_3">Methods</h4>
<h4 id="prototypes_3">prototypes</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prototypes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MemoryTextInstance</span><span class="p">]]</span>
</code></pre></div>
</td></tr></table>
<p>Select <code>n</code> prototypes (most representatitve instances).</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>int</td>
<td>Number of prototypes to select. Defaults to 5.</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Dict[str, Sequence[MemoryTextInstance]]</td>
<td>Dictionary with labels and corresponding list of prototypes.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def prototypes(self, n: int = 5) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Select `n` prototypes (most representatitve instances).

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary with labels and corresponding list of prototypes.

        &quot;&quot;&quot;

        return {label: sampler.prototypes(n=n)

                for label, sampler in self._samplers.items()}
</code></pre></div>
</td></tr></table>
</details>
<h3 id="mmdcritic">MMDCritic</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MMDCritic</span><span class="p">(</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">MemoryBucketProvider</span><span class="p">,</span>
    <span class="n">embedder</span><span class="p">:</span> <span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">Embedder</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">TfidfVectorizer</span><span class="s1">&#39;&gt;,</span>
    <span class="n">kernel</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">function</span> <span class="n">exponential_kernel</span> <span class="n">at</span> <span class="mh">0x16ddf9a60</span><span class="o">&gt;</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class MMDCritic(PrototypeSampler):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 embedder: Embedder = TfidfVectorizer,

                 kernel: Callable = exponential_kernel):

        &quot;&quot;&quot;Select prototypes and criticisms based on embedding distances using `MMD-Critic`_.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

            kernel (Callable, optional): Kernel to calculate distances. Defaults to exponential_kernel.

        .. _MMD-critic:

            https://christophm.github.io/interpretable-ml-book/proto.html

        &quot;&quot;&quot;

        super().__init__(instances, embedder)

        self.kernel = kernel

        self._calculate_kernel()

        self._prototypes = None

        self._criticisms = None

    def _calculate_kernel(self):

        &quot;&quot;&quot;Calculate kernel `K` and column totals `colsum`.&quot;&quot;&quot;

        self.K = self.kernel(self.embedded, 1.0 / self.embedded.shape[1])

        self.colsum = np.sum(self.K, axis=0) / self.embedded.shape[1]

    def prototypes(self, n: int = 5) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes (most representatitve instances), using `MMD-critic implementation`_.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        .. _MMD-critic implementation:

            https://github.com/maxidl/MMD-critic/blob/main/mmd_critic.py

        &quot;&quot;&quot;

        assert n &lt;= len(self.instances), f&#39;Cannot select more than all instances ({len(self.instances)}.&#39;

        K = self.K

        colsum = self.colsum.copy() * 2

        sample_indices = np.array(list(self.instances))

        is_selected = np.zeros_like(sample_indices)

        selected = sample_indices[is_selected &gt; 0]

        for i in range(n):

            candidate_indices = sample_indices[is_selected == 0]

            s1 = colsum[candidate_indices]

            diag = np.diagonal(K)[candidate_indices]

            if selected.shape[0] == 0:

                s1 -= np.abs(diag)

            else:

                temp = K[selected, :][:, candidate_indices]

                s2 = np.sum(temp, axis=0) * 2 + diag

                s2 /= (selected.shape[0] + 1)

                s1 -= s2

            best_sample_index = candidate_indices[np.argmax(s1)]

            is_selected[best_sample_index] = i + 1

            selected = sample_indices[is_selected &gt; 0]

        selected_in_order = selected[is_selected[is_selected &gt; 0].argsort()]

        self._prototypes = self._select_from_provider(selected_in_order)

        return self._prototypes

    def criticisms(self, n: int = 5, regularizer: Optional[str] = None) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` criticisms (instances not well represented by prototypes), using `MMD-critic implementation`_.

        Args:

            n (int, optional): Number of criticisms to select. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Raises:

            Exception: `MMDCritic.prototypes()` must first be run before being able to determine the criticisms.

        Returns:

            Sequence[MemoryTextInstance]: List of criticism instances.

        .. _MMD-critic implementation:

            https://github.com/maxidl/MMD-critic/blob/main/mmd_critic.py

        &quot;&quot;&quot;

        if self._prototypes is None:

            raise Exception(&#39;Calculating criticisms requires prototypes. Run `MMDCritic.prototypes()` first.&#39;)

        regularizers = {None, &#39;logdet&#39;, &#39;iterative&#39;}

        assert regularizer in regularizers, \

            f&#39;Unknown regularizer &quot;{regularizer}&quot;, choose from {regularizers}.&#39;

        assert n &lt;= (len(self.instances) - len(self._prototypes)), \

            f&#39;Cannot select more than instances excluding prototypes ({len(self.instances) - len(self._prototypes)})&#39;

        prototypes = np.array([p.identifier for p in self._prototypes])

        K = self.K

        colsum = self.colsum

        sample_indices = np.arange(0, len(self.instances))

        is_selected = np.zeros_like(sample_indices)

        selected = sample_indices[is_selected &gt; 0]

        is_selected[prototypes] = n + 1

        inverse_of_prev_selected = None

        for i in range(n):

            candidate_indices = sample_indices[is_selected == 0]

            s1 = colsum[candidate_indices]

            temp = K[prototypes, :][:, candidate_indices]

            s2 = np.sum(temp, axis=0)

            s2 /= prototypes.shape[0]

            s1 -= s2

            s1 = np.abs(s1)

            if regularizer == &#39;logdet&#39;:

                diag = np.diagonal(K)[candidate_indices]

                if inverse_of_prev_selected is not None:

                    temp = K[selected, :][:, candidate_indices]

                    temp2 = np.dot(inverse_of_prev_selected, temp)

                    reg = temp2 * temp

                    regcolsum = np.sum(reg, axis=0)

                    with np.errstate(divide=&#39;ignore&#39;):

                        reg = np.log(np.abs(diag - regcolsum))

                    s1 += reg

                else:

                    with np.errstate(divide=&#39;ignore&#39;):

                        s1 -= np.log(np.abs(diag))

            best_sample_index = candidate_indices[np.argmax(s1)]

            is_selected[best_sample_index] = i + 1

            selected = sample_indices[(is_selected &gt; 0) &amp; (is_selected != (n + 1))]

            if regularizer == &#39;iterative&#39;:

                prototypes = np.concatenate([prototypes, np.expand_dims(best_sample_index, 0)])

            if regularizer == &#39;logdet&#39;:

                inverse_of_prev_selected = np.linalg.pinv(K[selected, :][:, selected])

        selected_in_order = selected[is_selected[(is_selected &gt; 0) &amp; (is_selected != (n + 1))].argsort()]

        self._criticisms = self._select_from_provider(selected_in_order)

        return self._criticisms

    def __call__(self,

                 n_prototypes: int = 5,

                 n_criticisms: int = 5,

                 regularizer: Optional[str] = None) -&gt; Dict[str, Sequence[MemoryTextInstance]]:

        &quot;&quot;&quot;Calculate prototypes and criticisms for the provided instances.

        Args:

            n_prototypes (int, optional): Number of prototypes. Defaults to 5.

            n_criticisms (int, optional): Number of criticisms. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Returns:

            Dict[str, Sequence[MemoryTextInstance]]: Dictionary containing prototypes and criticisms.

        &quot;&quot;&quot;

        return {&#39;prototypes&#39;: self.prototypes(n=n_prototypes),

                &#39;criticisms&#39;: self.criticisms(n=n_criticisms, regularizer=regularizer)}
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_4">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.data.sampling.PrototypeSampler</li>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="instance-variables_1">Instance variables</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">embedded</span>
</code></pre></div>
</td></tr></table>
<h4 id="methods_4">Methods</h4>
<h4 id="criticisms_1">criticisms</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">criticisms</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="n">regularizer</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MemoryTextInstance</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<p>Select <code>n</code> criticisms (instances not well represented by prototypes), using <code>MMD-critic implementation</code>_. </p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>int</td>
<td>Number of criticisms to select. Defaults to 5.</td>
<td>5</td>
</tr>
<tr>
<td>regularizer</td>
<td>Optional[str]</td>
<td>Regularization method. Choose from [None, 'logdet', 'iterative'].</td>
<td></td>
</tr>
<tr>
<td>Defaults to None.</td>
<td>None</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sequence[MemoryTextInstance]</td>
<td>List of criticism instances.</td>
</tr>
<tr>
<td>.. _MMD-critic implementation:</td>
<td></td>
</tr>
<tr>
<td>https://github.com/maxidl/MMD-critic/blob/main/mmd_critic.py</td>
<td></td>
</tr>
</tbody>
</table>
<p><strong>Raises:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Exception</td>
<td><code>MMDCritic.prototypes()</code> must first be run before being able to determine the criticisms.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def criticisms(self, n: int = 5, regularizer: Optional[str] = None) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` criticisms (instances not well represented by prototypes), using `MMD-critic implementation`_.

        Args:

            n (int, optional): Number of criticisms to select. Defaults to 5.

            regularizer (Optional[str], optional): Regularization method. Choose from [None, &#39;logdet&#39;, &#39;iterative&#39;].

                Defaults to None.

        Raises:

            Exception: `MMDCritic.prototypes()` must first be run before being able to determine the criticisms.

        Returns:

            Sequence[MemoryTextInstance]: List of criticism instances.

        .. _MMD-critic implementation:

            https://github.com/maxidl/MMD-critic/blob/main/mmd_critic.py

        &quot;&quot;&quot;

        if self._prototypes is None:

            raise Exception(&#39;Calculating criticisms requires prototypes. Run `MMDCritic.prototypes()` first.&#39;)

        regularizers = {None, &#39;logdet&#39;, &#39;iterative&#39;}

        assert regularizer in regularizers, \

            f&#39;Unknown regularizer &quot;{regularizer}&quot;, choose from {regularizers}.&#39;

        assert n &lt;= (len(self.instances) - len(self._prototypes)), \

            f&#39;Cannot select more than instances excluding prototypes ({len(self.instances) - len(self._prototypes)})&#39;

        prototypes = np.array([p.identifier for p in self._prototypes])

        K = self.K

        colsum = self.colsum

        sample_indices = np.arange(0, len(self.instances))

        is_selected = np.zeros_like(sample_indices)

        selected = sample_indices[is_selected &gt; 0]

        is_selected[prototypes] = n + 1

        inverse_of_prev_selected = None

        for i in range(n):

            candidate_indices = sample_indices[is_selected == 0]

            s1 = colsum[candidate_indices]

            temp = K[prototypes, :][:, candidate_indices]

            s2 = np.sum(temp, axis=0)

            s2 /= prototypes.shape[0]

            s1 -= s2

            s1 = np.abs(s1)

            if regularizer == &#39;logdet&#39;:

                diag = np.diagonal(K)[candidate_indices]

                if inverse_of_prev_selected is not None:

                    temp = K[selected, :][:, candidate_indices]

                    temp2 = np.dot(inverse_of_prev_selected, temp)

                    reg = temp2 * temp

                    regcolsum = np.sum(reg, axis=0)

                    with np.errstate(divide=&#39;ignore&#39;):

                        reg = np.log(np.abs(diag - regcolsum))

                    s1 += reg

                else:

                    with np.errstate(divide=&#39;ignore&#39;):

                        s1 -= np.log(np.abs(diag))

            best_sample_index = candidate_indices[np.argmax(s1)]

            is_selected[best_sample_index] = i + 1

            selected = sample_indices[(is_selected &gt; 0) &amp; (is_selected != (n + 1))]

            if regularizer == &#39;iterative&#39;:

                prototypes = np.concatenate([prototypes, np.expand_dims(best_sample_index, 0)])

            if regularizer == &#39;logdet&#39;:

                inverse_of_prev_selected = np.linalg.pinv(K[selected, :][:, selected])

        selected_in_order = selected[is_selected[(is_selected &gt; 0) &amp; (is_selected != (n + 1))].argsort()]

        self._criticisms = self._select_from_provider(selected_in_order)

        return self._criticisms
</code></pre></div>
</td></tr></table>
</details>
<h4 id="prototypes_4">prototypes</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prototypes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MemoryTextInstance</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<p>Select <code>n</code> prototypes (most representatitve instances), using <code>MMD-critic implementation</code>_.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>int</td>
<td>Number of prototypes to select. Defaults to 5.</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sequence[MemoryTextInstance]</td>
<td>List of prototype instances.</td>
</tr>
<tr>
<td>.. _MMD-critic implementation:</td>
<td></td>
</tr>
<tr>
<td>https://github.com/maxidl/MMD-critic/blob/main/mmd_critic.py</td>
<td></td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def prototypes(self, n: int = 5) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes (most representatitve instances), using `MMD-critic implementation`_.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        .. _MMD-critic implementation:

            https://github.com/maxidl/MMD-critic/blob/main/mmd_critic.py

        &quot;&quot;&quot;

        assert n &lt;= len(self.instances), f&#39;Cannot select more than all instances ({len(self.instances)}.&#39;

        K = self.K

        colsum = self.colsum.copy() * 2

        sample_indices = np.array(list(self.instances))

        is_selected = np.zeros_like(sample_indices)

        selected = sample_indices[is_selected &gt; 0]

        for i in range(n):

            candidate_indices = sample_indices[is_selected == 0]

            s1 = colsum[candidate_indices]

            diag = np.diagonal(K)[candidate_indices]

            if selected.shape[0] == 0:

                s1 -= np.abs(diag)

            else:

                temp = K[selected, :][:, candidate_indices]

                s2 = np.sum(temp, axis=0) * 2 + diag

                s2 /= (selected.shape[0] + 1)

                s1 -= s2

            best_sample_index = candidate_indices[np.argmax(s1)]

            is_selected[best_sample_index] = i + 1

            selected = sample_indices[is_selected &gt; 0]

        selected_in_order = selected[is_selected[is_selected &gt; 0].argsort()]

        self._prototypes = self._select_from_provider(selected_in_order)

        return self._prototypes
</code></pre></div>
</td></tr></table>
</details>
<h3 id="prototypesampler">PrototypeSampler</h3>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">PrototypeSampler</span><span class="p">(</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">memory</span><span class="o">.</span><span class="n">MemoryBucketProvider</span><span class="p">,</span>
    <span class="n">embedder</span><span class="p">:</span> <span class="n">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">Embedder</span> <span class="o">=</span> <span class="o">&lt;</span><span class="k">class</span> <span class="err">&#39;</span><span class="nc">text_explainability</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">embedding</span><span class="o">.</span><span class="n">TfidfVectorizer</span><span class="s1">&#39;&gt;</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>class PrototypeSampler(Readable):

    def __init__(self,

                 instances: MemoryBucketProvider,

                 embedder: Embedder = TfidfVectorizer):

        &quot;&quot;&quot;Generic class for sampling prototypes (representative samples) based on embedding distances.

        Args:

            instances (MemoryBucketProvider): Instances to select from (e.g. training set, all instance from class 0).

            embedder (Embedder, optional): Method to embed instances (if the `.vector` property is not yet set).

                Defaults to TfidfVectorizer.

        &quot;&quot;&quot;

        self.embedder = embedder() if isinstance(embedder, type) else embedder

        self.instances = self.embedder(instances) if any(instances[i].vector is None for i in instances) \

                         else instances

    @property

    def embedded(self) -&gt; np.ndarray:

        return np.stack(self.instances.bulk_get_vectors(list(self.instances))[-1])

    def _select_from_provider(self, keys: Sequence[int]) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select instances from provider by keys.&quot;&quot;&quot;

        return [self.instances[i] for i in keys]

    def prototypes(self, n: int = 5) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        &quot;&quot;&quot;

        raise NotImplementedError(&#39;Implemented in subclasses&#39;)

    def __call__(self, *args, **kwargs):

        return self.prototypes(*args, **kwargs)
</code></pre></div>
</td></tr></table>
</details>
<hr />
<h4 id="ancestors-in-mro_5">Ancestors (in MRO)</h4>
<ul>
<li>text_explainability.default.Readable</li>
</ul>
<h4 id="descendants_1">Descendants</h4>
<ul>
<li>text_explainability.data.sampling.KMedoids</li>
<li>text_explainability.data.sampling.MMDCritic</li>
</ul>
<h4 id="instance-variables_2">Instance variables</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">embedded</span>
</code></pre></div>
</td></tr></table>
<h4 id="methods_5">Methods</h4>
<h4 id="prototypes_5">prototypes</h4>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">prototypes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">instancelib</span><span class="o">.</span><span class="n">instances</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">MemoryTextInstance</span><span class="p">]</span>
</code></pre></div>
</td></tr></table>
<p>Select <code>n</code> prototypes.</p>
<p><strong>Parameters:</strong></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr>
<td>n</td>
<td>int</td>
<td>Number of prototypes to select. Defaults to 5.</td>
<td>5</td>
</tr>
</tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Sequence[MemoryTextInstance]</td>
<td>List of prototype instances.</td>
</tr>
</tbody>
</table>
<details class="example"><summary>View Source</summary><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div class="highlight"><pre><span></span><code>    def prototypes(self, n: int = 5) -&gt; Sequence[MemoryTextInstance]:

        &quot;&quot;&quot;Select `n` prototypes.

        Args:

            n (int, optional): Number of prototypes to select. Defaults to 5.

        Returns:

            Sequence[MemoryTextInstance]: List of prototype instances.

        &quot;&quot;&quot;

        raise NotImplementedError(&#39;Implemented in subclasses&#39;)
</code></pre></div>
</td></tr></table>
</details>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../" title="Index" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Index
              </span>
            </div>
          </a>
        
        
          <a href="../weights/" title="Weights" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Weights
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Powered by
        <a href="http://timothycrosley.github.io/portray">portray.</a>
        You too can
        <a href="http://timothycrosley.github.io/portray">
          portray</a>
        your Python project well using automatic documentation.
      </div>
      
  <div class="md-footer-social">
    
      
      
      <a href="https://github.com/MarcelRobeer/Text_Explainability" target="_blank" rel="noopener" title="text_explainability on GitHub" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.53c85856.min.js", "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.716f8af4.min.js"></script>
      
    
  </body>
</html>